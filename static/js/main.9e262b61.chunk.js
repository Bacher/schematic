(this.webpackJsonpschematic=this.webpackJsonpschematic||[]).push([[0],{51:function(e,t,n){},54:function(e,t,n){"use strict";n.r(t);var i=n(1),o=n.n(i),r=n(40),s=n.n(r),a=(n(50),n(51),n(4)),c=n(3),l=n(44),u=Object(l.a)({theme:{colors:{gray400:"gainsboro",gray500:"lightgray"}},media:{bp1:"(min-width: 480px)",bp2:"(min-width: 768px)"},utils:{fontVariant:function(e){var t=e.split("|"),n=Object(c.a)(t,2),i=n[0],o=n[1];return{fontSize:"".concat(i,"px"),lineHeight:"".concat(o,"px")}}}}),h=u.styled;u.css,u.globalCss,u.keyframes,u.getCssText,u.theme,u.createTheme,u.config;function d(e){var t=Object(i.useRef)(e);return t.current=e,t}function p(e){var t=d(e);return Object(i.useCallback)((function(){return t.current.apply(t,arguments)}),[])}function v(e,t){var n=p(t);Object(i.useEffect)((function(){return window.addEventListener(e,n,!1),function(){window.removeEventListener(e,n,!1)}}),[e,n])}var f,m,O,y,b=n(59),E=n(6);!function(e){e.PNP="pnp",e.NPN="npn",e.POWER="power",e.GROUND="ground",e.INPUT="input",e.OUTPUT="output",e.DOT="dot"}(f||(f={})),function(e){e[e.ELEMENT=0]="ELEMENT",e[e.CONNECTION=1]="CONNECTION"}(m||(m={})),function(e){e[e.NONE=0]="NONE",e[e.LOADING=1]="LOADING",e[e.DONE=2]="DONE"}(O||(O={}));var g,j,x=48,w=(y={},Object(E.a)(y,f.PNP,{pins:[{pos:{x:.47,y:.94}},{pos:{x:-.07,y:.32}},{pos:{x:1.05,y:.32}}]}),Object(E.a)(y,f.NPN,{pins:[{pos:{x:.47,y:1}},{pos:{x:-.07,y:.33}},{pos:{x:1.05,y:.32}}]}),Object(E.a)(y,f.POWER,{pins:[{pos:{x:.52,y:.8}}]}),Object(E.a)(y,f.GROUND,{pins:[{pos:{x:.46,y:.15}}]}),Object(E.a)(y,f.INPUT,{pins:[{pos:{x:.5,y:.8}}]}),Object(E.a)(y,f.OUTPUT,{pins:[{pos:{x:.2,y:.5}}]}),Object(E.a)(y,f.DOT,{pins:[{pos:{x:.5,y:.5}}]}),y),I={isInputVector:!1,isOutputVector:!1,simulate:!1,debugDrawId:!1,debugDrawAxis:!1,debugShowFps:!1},S=n(2),N=n(12),P=n(25),T=n(26),k=n(7),M=n(57),D=n(55),C=n(58),U=n(56),R=n(37),L=n(41),W=n(36),V=n.n(W);function A(e,t){return{x:e.x-t.x,y:e.y-t.y}}function G(e,t){var n=Math.sin(t),i=Math.cos(t);return{x:e.x*i-e.y*n,y:e.x*n+e.y*i}}function F(e){return"".concat(e.elId,":").concat(e.pinIndex)}function H(e,t,n){var i=!1;function o(t){var n=t.split(":")[0],i=e.find((function(e){return e.id===n}));if(!i)throw new Error("No element");return i}var r,s=e.filter((function(e){return e.type===f.INPUT})),l=new Map,u=new Set,h=Object(S.a)(t);try{for(h.s();!(r=h.n()).done;){var d=Object(c.a)(r.value,2),p=d[0],v=d[1],m=F(p),O=F(v),y=l.get(m),b=l.get(O);if(y&&b){var E=[].concat(Object(a.a)(y),Object(a.a)(b));u.delete(y),u.delete(b),u.add(E);var j,x=Object(S.a)(E);try{for(x.s();!(j=x.n()).done;){var w=j.value;l.set(w,E)}}catch(P){x.e(P)}finally{x.f()}}else if(y)y.push(O),l.set(O,y);else if(b)b.push(m),l.set(m,b);else{var I=[m,O];u.add(I),l.set(m,I),l.set(O,I)}}}catch(P){h.e(P)}finally{h.f()}var N=Object(a.a)(u.values()).map((function(e){return{state:g.IMPEDANCE,pins:e}}));return function(e){var t,r=new Map,a=Object(S.a)(e);try{for(a.s();!(t=a.n()).done;){var c,l=t.value,u=Object(S.a)(l.pins);try{for(u.s();!(c=u.n()).done;){var h=c.value;r.set(h,l)}}catch(P){u.e(P)}finally{u.f()}}}catch(P){a.e(P)}finally{a.f()}var d=!0;function p(e,t){return t===g.POWER&&e.state===g.GROUND||t===g.GROUND&&e.state===g.POWER?(i=!0,void(e.state=g.SHORT_CIRCUIT)):void(e.state!==t?(e.state=t,d=!0):d=!1)}for(;d;){d=!1;var v,m=Object(S.a)(e);try{for(m.s();!(v=m.n()).done;){var O,y=v.value,b=Object(S.a)(y.pins);try{for(b.s();!(O=b.n()).done;){var E=o(O.value);switch(E.type){case f.INPUT:var j=s.indexOf(E);p(y,n[j]?g.POWER:g.GROUND);break;case f.POWER:p(y,g.POWER);break;case f.GROUND:p(y,g.GROUND);break;case f.NPN:var x=r.get("".concat(E.id,":0")),w=r.get("".concat(E.id,":1")),I=r.get("".concat(E.id,":2"));x&&x.state===g.GROUND&&w&&w.state===g.POWER&&I&&p(I,g.POWER);break;case f.PNP:var N=r.get("".concat(E.id,":0")),T=r.get("".concat(E.id,":1")),k=r.get("".concat(E.id,":2"));N&&N.state===g.POWER&&T&&T.state===g.GROUND&&k&&p(k,g.GROUND)}if(i)return}}catch(P){b.e(P)}finally{b.f()}}}catch(P){m.e(P)}finally{m.f()}break}}(N),N}function B(){var e=Object(i.useRef)(0),t=Object(i.useState)(e.current),n=Object(c.a)(t,2)[1];return Object(i.useCallback)((function(){e.current+=1,n(e.current)}),[])}function _(e,t){return e.filter((function(e,n){return n!==t}))}function J(e){return"sch_game_".concat(e)}function z(e,t,n){var i=n.value;n.value=function(){if(!(this instanceof X))throw new Error;var e=!1;this.underWatch||(e=!0,this.underWatch=!0);for(var t=this.getState(),n=arguments.length,o=new Array(n),r=0;r<n;r++)o[r]=arguments[r];var s=i.apply(this,o);if(e){if(!this.needTriggerUpdate){var a=this.getState();this.needTriggerUpdate=t!==a}this.needTriggerUpdate&&(this.needTriggerUpdate=!1,this.triggerUpdate()),this.underWatch=!1}return s}}function Y(e,t,n){var i=n.value;n.value=function(){if(!(this instanceof X))throw new Error;for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var o=i.apply(this,t);return this.underWatch?this.needTriggerUpdate=!0:this.triggerUpdate(),o}}!function(e){e[e.IMPEDANCE=0]="IMPEDANCE",e[e.GROUND=1]="GROUND",e[e.POWER=2]="POWER",e[e.SHORT_CIRCUIT=3]="SHORT_CIRCUIT"}(g||(g={}));var X=(j=function(){function e(t){var n=t.gameId,i=t.elements,o=t.connections,r=t.inputSignals,s=t.pos,a=t.options;Object(P.a)(this,e),this.underWatch=!1,this.needTriggerUpdate=!1,this.gameId=void 0,this.drawHandler=void 0,this.elements=void 0,this.connections=void 0,this.inputSignals=void 0,this.pos=void 0,this.options=void 0,this.hoverElement=void 0,this.focusElement=void 0,this.wireElement=void 0,this.movingElement=void 0,this.mousePos=void 0,this.mouseState=void 0,this.panState=void 0,this.lastStateSnapshot=void 0,this.stateListeners=void 0,this.getNodesSimulationStateMemoized=Object(L.a)(H),this.gameId=n,this.elements=i,this.connections=o,this.inputSignals=r,this.pos=s,this.options=a,window.gameModel=this,this.hoverElement=void 0,this.focusElement=void 0,this.wireElement=void 0,this.movingElement=void 0,this.mouseState={isMouseDown:!1},this.panState={isPan:!1},this.mousePos=void 0,this.stateListeners=[],this.lastStateSnapshot=void 0}return Object(T.a)(e,[{key:"setDrawHandler",value:function(e){this.drawHandler=e}},{key:"saveGame",value:function(){localStorage.setItem(J(this.gameId),JSON.stringify({pos:this.pos,elements:this.elements,inputSignals:this.inputSignals,connections:this.connections,options:this.options}))}},{key:"getState",value:function(){var e={elements:this.elements,connections:this.connections,inputSignals:this.inputSignals,pos:this.pos,options:this.options,hoverElement:this.hoverElement,focusElement:this.focusElement,wireElement:this.wireElement,movingElement:this.movingElement,panState:this.panState,cursor:this.getCursor()};return this.lastStateSnapshot&&V()(e,this.lastStateSnapshot)||(this.lastStateSnapshot=e),this.lastStateSnapshot}},{key:"deleteElementInFocus",value:function(){var e=this.focusElement;if(e){switch(e.type){case m.ELEMENT:this.connections=this.connections.filter((function(t){var n=Object(c.a)(t,2),i=n[0],o=n[1];return i.elId!==e.elId&&o.elId!==e.elId}));var t=this.elements.find((function(t){return t.id===e.elId}));if(!t)throw new Error;if(t.type===f.INPUT){var n=this.elements.filter((function(e){return e.type===f.INPUT})).indexOf(t);this.inputSignals=_(this.inputSignals,n)}this.elements=Object(M.a)(this.elements,t);break;case m.CONNECTION:this.connections=_(this.connections,e.connectionIndex)}this.focusElement=void 0}}},{key:"updateInputSignals",value:function(e){this.inputSignals=e}},{key:"updateOptions",value:function(e){this.options=e}},{key:"onMouseDown",value:function(){this.mouseState.isMouseDown&&this.onMouseUp(),this.mouseState.isMouseDown=!0}},{key:"onMouseMove",value:function(e){var t=this,n=e.position,i=n.x,o=n.y,r=e.movement,s=r.x,a=r.y;this.mousePos={x:i,y:o},this.checkHover();var c=Boolean(this.movingElement);if(this.mouseState.isMouseDown){!c&&!this.wireElement&&this.hoverElement&&this.hoverElement.type===m.ELEMENT&&this.hoverElement.activePin&&this.startWiring({elId:this.hoverElement.elId,pinIndex:this.hoverElement.activePin.index}),c||this.wireElement||!this.hoverElement||this.hoverElement.type!==m.ELEMENT||(this.movingElement={elId:this.hoverElement.elId},this.focusElement={type:m.ELEMENT,elId:this.hoverElement.elId}),this.wireElement||this.movingElement||this.panState.isPan||(this.panState={isPan:!0});var l=this.movingElement;l?this.updateElement(l.elId,(function(e){e.pos.x+=s,e.pos.y+=a})):this.wireElement||(this.pos={x:this.pos.x+s,y:this.pos.y+a})}else this.panState.isPan&&(this.panState={isPan:!1});this.wireElement&&(this.wireElement=Object(R.a)(this.wireElement,(function(e){e.pullPos&&t.mousePos?(e.pullPos.x=t.mousePos.x,e.pullPos.y=t.mousePos.y):e.pullPos=t.mousePos})))}},{key:"onMouseUp",value:function(){this.mouseState={isMouseDown:!1},!this.focusElement||this.focusElement.type!==m.ELEMENT||this.wireElement||this.movingElement||(this.focusElement=void 0),this.movingElement&&(this.movingElement=void 0),this.panState.isPan&&(this.panState={isPan:!1}),this.wireElement?(this.hoverElement&&this.hoverElement.type===m.ELEMENT&&this.hoverElement.activePin&&this.wireElement.elId!==this.hoverElement.elId&&(this.connections=[].concat(Object(a.a)(this.connections),[[{elId:this.hoverElement.elId,pinIndex:this.hoverElement.activePin.index},{elId:this.wireElement.elId,pinIndex:this.wireElement.pinIndex}]])),this.wireElement=void 0):this.wireElement||(this.hoverElement&&this.hoverElement.type===m.ELEMENT&&this.hoverElement.activePin&&this.startWiring({elId:this.hoverElement.elId,pinIndex:this.hoverElement.activePin.index}),this.hoverElement&&(this.hoverElement.type!==m.ELEMENT||this.hoverElement.activePin?this.hoverElement.type===m.CONNECTION&&(this.focusElement&&this.focusElement.type===m.CONNECTION&&this.focusElement.connectionIndex===this.hoverElement.connectionIndex||(this.focusElement={type:m.CONNECTION,connectionIndex:this.hoverElement.connectionIndex})):this.focusElement&&this.focusElement.type===m.ELEMENT&&this.focusElement.elId===this.hoverElement.elId||(this.focusElement={type:m.ELEMENT,elId:this.hoverElement.elId})))}},{key:"getCursor",value:function(){var e=this.wireElement,t=this.hoverElement,n=this.panState;if(e)return"pointer";if(t){if(t.type===m.CONNECTION)return"move";if(t.type===m.ELEMENT)return t.activePin?"pointer":"move";if(n.isPan)return"grabbing"}return"move"}},{key:"addElement",value:function(e){for(var t=Object(N.a)({},this.pos);this.checkOverlap(t);)t.x+=68;this.elements=[].concat(Object(a.a)(this.elements),[{type:e,id:this.getNextId(),pos:t}]),this.inputSignals=[].concat(Object(a.a)(this.inputSignals),[!1])}},{key:"startWiring",value:function(e){var t=e.elId,n=e.pinIndex;this.focusElement={type:m.ELEMENT,elId:t},this.wireElement={elId:t,pinIndex:n,pullPos:this.mousePos}}},{key:"resetCursorState",value:function(){this.movingElement=void 0,this.wireElement=void 0,this.mouseState.isMouseDown&&(this.mouseState={isMouseDown:!1}),this.panState.isPan&&(this.panState={isPan:!1})}},{key:"triggerUpdate",value:function(){this.drawHandler&&this.drawHandler();var e,t=this.getState(),n=Object(S.a)(this.stateListeners);try{for(n.s();!(e=n.n()).done;){e.value.isActual=!1}}catch(d){n.e(d)}finally{n.f()}var i,o=Object(S.a)(this.stateListeners);try{for(o.s();!(i=o.n()).done;){var r=i.value;if(!r.isActual){var s=r.forceUpdate,a=r.selector,c=r.lastSelectedValue,l=a(t);V()(l,c)||(r.actualSelectedValue={value:l},s())}}}catch(d){o.e(d)}finally{o.f()}var u,h=Object(S.a)(this.stateListeners);try{for(h.s();!(u=h.n()).done;){u.value.actualSelectedValue=void 0}}catch(d){h.e(d)}finally{h.f()}}},{key:"clearState",value:function(){this.pos={x:0,y:0},this.elements=[],this.connections=[],this.inputSignals=[],this.hoverElement=void 0,this.focusElement=void 0,this.movingElement=void 0,this.wireElement=void 0,this.panState.isPan=!1,this.mouseState.isMouseDown=!1}},{key:"reloadFromSave",value:function(){try{var t=e.getLoadedState(this.gameId),n=t.elements,i=t.connections,o=t.pos,r=t.options,s=t.inputSignals;this.clearState(),this.elements=n,this.connections=i,this.pos=o,this.options=r,this.inputSignals=s}catch(a){console.error("Can't load state:",a)}}},{key:"updateElement",value:function(e,t){this.elements=Object(R.a)(this.elements,(function(n){var i=n.find((function(t){return t.id===e}));if(!i)throw new Error("Element ".concat(e," is not found"));t(i)}))}},{key:"checkHover",value:function(){if(this.mousePos){var e,t=A(this.mousePos,this.pos),n=t.x,i=t.y,o=!1,r=!1,s=Object(S.a)(this.elements);try{for(s.s();!(e=s.n()).done;){var a,l=e.value,u=w[l.type].pins,h=l.pos.x-24,d=l.pos.y-24,p=Object(S.a)(u);try{for(p.s();!(a=p.n()).done;){var v=a.value;if(Math.pow(h+v.pos.x*x-n,2)+Math.pow(d+v.pos.y*x-i,2)<Math.pow(9,2)){var f,O=u.indexOf(v);this.hoverElement&&this.hoverElement.type===m.ELEMENT&&this.hoverElement.elId===l.id&&(null===(f=this.hoverElement.activePin)||void 0===f?void 0:f.index)===O||(this.hoverElement={type:m.ELEMENT,elId:l.id,activePin:{index:O}}),o=!0;break}}}catch(F){p.e(F)}finally{p.f()}}}catch(F){s.e(F)}finally{s.f()}if(!o){var y,b=Object(S.a)(this.elements);try{for(b.s();!(y=b.n()).done;){var E=y.value,g=E.pos.x-24,j=E.pos.y-24;if(n>g&&n<g+x&&i>j&&i<j+x){this.hoverElement&&this.hoverElement.type===m.ELEMENT&&this.hoverElement.elId===E.id&&!this.hoverElement.activePin||(this.hoverElement={type:m.ELEMENT,elId:E.id,activePin:void 0}),o=!0;break}}}catch(F){b.e(F)}finally{b.f()}}if(!o){var I,N=Object(S.a)(this.connections);try{for(N.s();!(I=N.n()).done;){var P=I.value,T=Object(c.a)(P,2),k=T[0],M=T[1],D=this.getConnectionPinPosition(k),C=A(this.getConnectionPinPosition(M),D),U=A({x:n,y:i},D),R=Math.atan2(C.y,C.x),L=G(C,-R),W=G(U,-R);if(W.x>=-10&&W.x<=L.x+10&&W.y>-10&&W.y<10){var V=this.connections.indexOf(P);this.hoverElement&&this.hoverElement.type===m.CONNECTION&&this.hoverElement.connectionIndex===V||(this.hoverElement={type:m.CONNECTION,connectionIndex:V}),r=!0;break}}}catch(F){N.e(F)}finally{N.f()}}o||r||this.hoverElement&&(this.hoverElement=void 0)}else this.hoverElement&&(this.hoverElement=void 0)}},{key:"getConnectionPinPosition",value:function(e){var t=e.elId,n=e.pinIndex,i=this.getElById(t),o=w[i.type].pins[n];return{x:i.pos.x+(o.pos.x-.5)*x,y:i.pos.y+(o.pos.y-.5)*x}}},{key:"getElById",value:function(e){var t=this.elements.find((function(t){return t.id===e}));if(!t)throw new Error("Element not found");return t}},{key:"checkOverlap",value:function(e){var t,n=Object(S.a)(this.elements);try{for(n.s();!(t=n.n()).done;){var i=t.value.pos;if(Math.pow(i.x-e.x,2)+Math.pow(i.y-e.y,2)<Math.pow(24,2))return!0}}catch(o){n.e(o)}finally{n.f()}return!1}},{key:"getNextId",value:function(){var e=Object(D.a)(this.elements);if(!e)return"el1";var t=e.id.match(/^el(\d+)$/);if(!t)throw new Error;return"el".concat(parseInt(t[1],10)+1)}},{key:"allowOpenContextMenu",value:function(){return!this.hoverElement&&!this.wireElement&&!this.panState.isPan}},{key:"getSimulation",value:function(){if(this.options.simulate)return this.getNodesSimulationStateMemoized(this.elements,this.connections,this.inputSignals)}}],[{key:"createEmptyModel",value:function(t){return new e({gameId:t,pos:{x:0,y:0},elements:[],connections:[],inputSignals:[],options:I})}},{key:"getLoadedState",value:function(e){var t=localStorage.getItem(J(e));if(!t)throw new Error("No saved game");var n=JSON.parse(t),i=n.pos,o=n.elements,r=n.inputSignals,s=n.connections,a=n.options,c=Object.keys(I);return{gameId:e,pos:i,elements:o,connections:s,inputSignals:r,options:Object(C.a)(Object(U.a)(a,c),I)}}},{key:"checkSavedGame",value:function(e){var t=localStorage.getItem(J(e));return Boolean(t)}},{key:"loadGame",value:function(t){return new e(e.getLoadedState(t))}}]),e}(),Object(k.a)(j.prototype,"deleteElementInFocus",[z],Object.getOwnPropertyDescriptor(j.prototype,"deleteElementInFocus"),j.prototype),Object(k.a)(j.prototype,"updateInputSignals",[Y],Object.getOwnPropertyDescriptor(j.prototype,"updateInputSignals"),j.prototype),Object(k.a)(j.prototype,"updateOptions",[Y],Object.getOwnPropertyDescriptor(j.prototype,"updateOptions"),j.prototype),Object(k.a)(j.prototype,"onMouseMove",[z],Object.getOwnPropertyDescriptor(j.prototype,"onMouseMove"),j.prototype),Object(k.a)(j.prototype,"onMouseUp",[z],Object.getOwnPropertyDescriptor(j.prototype,"onMouseUp"),j.prototype),Object(k.a)(j.prototype,"addElement",[Y],Object.getOwnPropertyDescriptor(j.prototype,"addElement"),j.prototype),Object(k.a)(j.prototype,"startWiring",[z],Object.getOwnPropertyDescriptor(j.prototype,"startWiring"),j.prototype),Object(k.a)(j.prototype,"resetCursorState",[z],Object.getOwnPropertyDescriptor(j.prototype,"resetCursorState"),j.prototype),Object(k.a)(j.prototype,"clearState",[Y],Object.getOwnPropertyDescriptor(j.prototype,"clearState"),j.prototype),Object(k.a)(j.prototype,"reloadFromSave",[Y],Object.getOwnPropertyDescriptor(j.prototype,"reloadFromSave"),j.prototype),Object(k.a)(j.prototype,"updateElement",[z],Object.getOwnPropertyDescriptor(j.prototype,"updateElement"),j.prototype),Object(k.a)(j.prototype,"checkHover",[z],Object.getOwnPropertyDescriptor(j.prototype,"checkHover"),j.prototype),j);function $(e,t){var n,i=B(),o=e.stateListeners.find((function(e){return e.forceUpdate===i})),r=p(t),s=e.getState();if(o)return o.isActual=!0,n=o.actualSelectedValue?o.actualSelectedValue.value:r(s),o.lastSelectedValue=n,o.isActual=!0,n;var a=r(s);return e.stateListeners.push({forceUpdate:i,selector:r,actualSelectedValue:void 0,lastSelectedValue:a,isActual:!0}),a}function Z(e){return Object(i.useRef)(e).current}function Q(e){var t=e.elementsCount,n=e.index,i=e.isInput,o=i?"ABCDEFGHIJ":"YZXWVUTSRQ";return!e.isVector&&t<=o.length?o.charAt(n):i?"I".concat(n):"Y".concat(n)}function q(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return Q({elementsCount:e.length,index:e.indexOf(t),isInput:t.type===f.INPUT,isVector:n})}var K=48;function ee(){var e=Object(i.useState)(!0),t=Object(c.a)(e,2),n=t[0],o=t[1];return function(e,t){var n=p(t);Object(i.useEffect)((function(){return document.addEventListener(e,n,!1),function(){document.removeEventListener(e,n,!1)}}),[e,n])}("visibilitychange",(function(){var e="visible"===document.visibilityState;n!==e&&o(e)})),n}var te=n(0),ne=h("table",{"> thead > tr > th":{textAlign:"center",fontWeight:700},"> tbody > tr > td":{textAlign:"center",fontWeight:400}});function ie(e){var t=$(e.gameModel,(function(e){return{elements:e.elements,options:e.options}})),n=t.elements,o=t.options,r=Object(i.useMemo)((function(){var e=n.filter((function(e){return e.type===f.INPUT})),t=n.filter((function(e){return e.type===f.OUTPUT})),i=e,r=t;return o.isInputVector&&(i=Object(a.a)(e).reverse()),o.isOutputVector&&(r=Object(a.a)(t).reverse()),{inputs:e,outputs:t,renderInputs:i,renderOutputs:r}}),[n,n.length,o.isInputVector,o.isOutputVector]),s=r.inputs,c=r.outputs,l=r.renderInputs,u=r.renderOutputs;return Object(te.jsx)("div",{children:Object(te.jsxs)(ne,{children:[Object(te.jsx)("thead",{children:Object(te.jsxs)("tr",{children:[l.map((function(e,t){return Object(te.jsx)("th",{children:q(s,e,o.isInputVector)},t)})),u.map((function(e,t){return Object(te.jsx)("th",{children:q(c,e,o.isOutputVector)},t)}))]})}),Object(te.jsx)("tbody",{children:Array.from({length:Math.pow(2,s.length)}).map((function(e,t){return Object(te.jsxs)("tr",{children:[l.map((function(e,n){return Object(te.jsx)("td",{children:Math.floor(t/Math.pow(2,s.length-n-1))%2},n)})),u.map((function(e,t){return Object(te.jsx)("td",{children:"Z"},t)}))]},t)}))})]})})}var oe=h("h2",{margin:0});function re(e){var t,n=$(e.gameModel,(function(e){return{elements:e.elements,connections:e.connections}})),i=n.elements,o=n.connections,r=[],s=Object(S.a)(i);try{for(s.s();!(t=s.n()).done;){var a,c=t.value,l=w[c.type].pins.map((function(){return!1})),u=Object(S.a)(o);try{for(u.s();!(a=u.n()).done;){var h,d=a.value,p=Object(S.a)(d);try{for(p.s();!(h=p.n()).done;){var v=h.value;v.elId===c.id&&(l[v.pinIndex]=!0)}}catch(f){p.e(f)}finally{p.f()}}}catch(f){u.e(f)}finally{u.f()}l.some((function(e){return!e}))&&r.push("Floating pins on node ".concat(c.type))}}catch(f){s.e(f)}finally{s.f()}return r.length?Object(te.jsxs)("div",{children:[Object(te.jsx)(oe,{children:"Errors:"}),r.map((function(e,t){return Object(te.jsx)("div",{children:e},t)}))]}):null}var se=h("div",{position:"absolute",display:"flex",alignItems:"stretch",left:52,bottom:0,padding:4}),ae=h("h2",{marginRight:8,fontVariant:"20|30"}),ce=h("div",{display:"flex",gap:4,variants:{reverse:{true:{flexDirection:"row-reverse"}}}}),le=h("label",{display:"grid",gridTemplateAreas:'"A"',width:30,height:30,userSelect:"none",cursor:"pointer","> *":{gridArea:"A"}}),ue=h("input",{opacity:0}),he=h("div",{background:"#aaa","input:checked + &":{background:"#0d0"}}),de=h("p",{textAlign:"center",fontVariant:"16|30"});function pe(e){var t=e.gameModel,n=$(t,(function(e){return{inputSignals:e.inputSignals,options:e.options}})),i=n.inputSignals,o=n.options;return Object(te.jsxs)(se,{children:[Object(te.jsx)(ae,{children:"Input signals:"}),Object(te.jsx)(ce,{reverse:o.isInputVector,children:i.map((function(e,n){return Object(te.jsxs)(le,{children:[Object(te.jsx)(ue,{type:"checkbox",checked:e,onChange:function(e){var o=i.map((function(t,i){return i===n?e.target.checked:t}));t.updateInputSignals(o)}}),Object(te.jsx)(he,{}),Object(te.jsx)(de,{children:Q({elementsCount:i.length,index:n,isInput:!0,isVector:o.isInputVector})})]},n)}))})]})}var ve=h("div",{position:"absolute",display:"flex",flexDirection:"column",gap:4,top:0,left:0,padding:4,borderRadius:2}),fe=h("button",{width:48,height:48,flexShrink:0,border:"none",color:"#333",background:"#dadada",fontVariant:"14|20",whiteSpace:"nowrap",appearance:"none","&:disabled":{color:"#999"},"&:not(:disabled)":{cursor:"pointer"}}),me=h("span",{height:8});function Oe(e){var t=e.gameModel,n=$(t,(function(e){return e.focusElement}));return Object(te.jsxs)(ve,{children:[Object(te.jsx)(fe,{type:"button",onClick:function(e){e.preventDefault(),t.addElement(f.POWER)},children:"DD"}),Object(te.jsx)(fe,{type:"button",onClick:function(e){e.preventDefault(),t.addElement(f.GROUND)},children:"GND"}),Object(te.jsx)(fe,{type:"button",onClick:function(e){e.preventDefault(),t.addElement(f.NPN)},children:"npn"}),Object(te.jsx)(fe,{type:"button",onClick:function(e){e.preventDefault(),t.addElement(f.PNP)},children:"pnp"}),Object(te.jsx)(fe,{type:"button",onClick:function(e){e.preventDefault(),t.addElement(f.INPUT)},children:"input"}),Object(te.jsx)(fe,{type:"button",onClick:function(e){e.preventDefault(),t.addElement(f.OUTPUT)},children:"output"}),Object(te.jsx)(fe,{type:"button",onClick:function(e){e.preventDefault(),t.addElement(f.DOT)},children:"dot"}),Object(te.jsx)(me,{}),Object(te.jsx)(fe,{type:"button",disabled:!n,onClick:function(e){e.preventDefault(),t.deleteElementInFocus()},children:"delete"}),Object(te.jsx)(me,{}),Object(te.jsx)(fe,{type:"button",onClick:function(e){e.preventDefault(),t.reloadFromSave()},children:"Reload"}),Object(te.jsx)(fe,{type:"button",onClick:function(e){e.preventDefault(),t.saveGame()},children:"Save"}),Object(te.jsx)(fe,{type:"button",onClick:function(e){e.preventDefault(),t.clearState()},children:"Clear"}),Object(te.jsx)("a",{href:"#",title:"",children:Object(te.jsx)(fe,{type:"button",children:"Exit"})})]})}var ye=h("label",{userSelect:"none","> input:not(:disabled)":{cursor:"pointer"}});function be(e){var t=e.title,n=e.checked,i=e.onChange;return Object(te.jsxs)(ye,{children:[Object(te.jsx)("input",{type:"checkbox",checked:n,onChange:function(e){i(e.target.checked)}})," ",t]})}var Ee=h("div",{display:"flex",flexDirection:"column","> *":{flexShrink:0}}),ge=h("button",{marginBottom:5,border:"1px solid #999",borderRadius:0,appearance:"none",cursor:"pointer",variants:{active:{true:{color:"#fff",background:"lightgreen"}}}});function je(e){var t=e.gameModel,n=$(t,(function(e){return e.options}));function i(e){t.updateOptions(Object(N.a)(Object(N.a)({},n),e))}return Object(te.jsxs)(Ee,{children:[Object(te.jsx)(ge,{type:"button",active:n.simulate,onClick:function(e){e.preventDefault(),i({simulate:!n.simulate})},children:n.simulate?"Simulation: ON":"Simulation: OFF"}),Object(te.jsx)(be,{title:"Debug: draw fps",checked:n.debugShowFps,onChange:function(e){i({debugShowFps:e})}}),Object(te.jsx)(be,{title:"Debug: draw id",checked:n.debugDrawId,onChange:function(e){i({debugDrawId:e})}}),Object(te.jsx)(be,{title:"Debug: draw axis",checked:n.debugDrawAxis,onChange:function(e){i({debugDrawAxis:e})}}),Object(te.jsx)(be,{title:"Treat input as vector",checked:n.isInputVector,onChange:function(e){i({isInputVector:e})}}),Object(te.jsx)(be,{title:"Treat output as vector",checked:n.isOutputVector,onChange:function(e){i({isOutputVector:e})}})]})}var xe=h("span",{color:"#4ebd4e"}),we=h("span",{color:"#666"});function Ie(e){return e?Object(te.jsx)(xe,{children:"yes"}):Object(te.jsx)(we,{children:"no"})}function Se(e){var t=$(e.gameModel,(function(e){return e})),n=t.elements,i=t.connections,o=t.movingElement,r=t.focusElement,s=t.hoverElement,a=t.wireElement,c=t.panState;return Object(te.jsxs)("div",{children:[Object(te.jsxs)("div",{children:["elements: ",n.length]}),Object(te.jsxs)("div",{children:["connections: ",i.length]}),Object(te.jsxs)("div",{children:["el moving: ",Ie(o)]}),Object(te.jsxs)("div",{children:["el in focus:"," ",Ie(r&&r.type===m.ELEMENT)]}),Object(te.jsxs)("div",{children:["conn in focus:"," ",Ie(r&&r.type===m.CONNECTION)]}),Object(te.jsxs)("div",{children:["el hover:"," ",Ie(s&&s.type===m.ELEMENT)]}),Object(te.jsxs)("div",{children:["pin hover:"," ",Ie(s&&s.type===m.ELEMENT&&s.activePin)]}),Object(te.jsxs)("div",{children:["conn hover:"," ",Ie(s&&s.type===m.CONNECTION)]}),Object(te.jsxs)("div",{children:["wiring: ",Ie(a)]}),Object(te.jsxs)("div",{children:["drag: ",Ie(c.isPan)]})]})}var Ne=h("main",{position:"relative",display:"flex",alignItems:"stretch",flexGrow:1,width:"100%",height:"100%",overflow:"hidden"}),Pe=h("div",{position:"relative",flexGrow:1,overflow:"hidden"}),Te=h("canvas",{display:"block",cursor:"grab",variants:{enableScaling:{true:{transformOrigin:"0 0",transform:"scale(var(--factor, 1))"}}}}),ke=h("span",{position:"absolute",top:6,right:6,userSelect:"none",pointerEvents:"none"}),Me=h("span",{flexGrow:1}),De=h("div",{display:"none","@bp2":{display:"flex",flexShrink:0,flexDirection:"column",flexBasis:300,padding:"16px 20px",borderLeft:"1px solid #888",background:"#ddd",overflow:"hidden",overflowY:"auto","> *:not(:last-child)":{marginBottom:16}}});function Ce(){var e;return null!==(e=window.devicePixelRatio)&&void 0!==e?e:1}function Ue(e){var t=e.gameId,n=Object(i.useRef)(null),o=Object(i.useRef)(null),r=B(),s=Object(i.useState)(0),a=Object(c.a)(s,2),l=a[0],u=a[1],h=Z({value:Ce()}),y=Object(i.useMemo)((function(){return X.checkSavedGame(t)?X.loadGame(t):X.createEmptyModel(t)}),[t]),E=$(y,(function(e){return{cursor:e.cursor,showFps:e.options.debugShowFps}})),g=E.cursor,j=E.showFps,x=Z({value:0});!function(e,t){var n=ee(),o=d(e);Object(i.useEffect)((function(){if(n&&o.current){var e=window.setInterval((function(){o.current&&o.current()}),t);return function(){window.clearInterval(e)}}}),[n,t,Boolean(o.current)])}(j?function(){u(x.value),x.value=0}:void 0,1e3);var I=Z({width:0,height:0}),N=function(e){var t=e.densityFactor,n=e.draw,o=Z({x1:{images:{},status:O.NONE},x2:{images:{},status:O.NONE}});return Object(i.useEffect)((function(){var e=t>1.5,i=o[e?"x1":"x2"];if(i.status===O.NONE){var r=[f.PNP,f.NPN,f.POWER,f.GROUND],s=r.length;i.status=O.LOADING;for(var a=function(){var t=l[c],n=new Image;n.src="assets/".concat(t).concat(e?"@2x":"",".png"),n.addEventListener("load",(function(){i.images[t]=n,u()})),n.addEventListener("error",u)},c=0,l=r;c<l.length;c++)a()}function u(){0===(s-=1)&&(i.status=O.DONE,n())}}),[t]),o}({densityFactor:h.value,draw:function(){return M()}});function P(e){var t=e.x,n=e.y;return{x:Math.floor(t-I.width/2),y:Math.floor(n-I.height/2)}}function T(){var e=Ce();return e!==h.value&&(h.value=e,r(),!0)}var k=p((function(){if(0!==I.width&&!T()){var e=function(e){if(!e)throw new Error;var t=e.getContext("2d");if(!t)throw new Error;return t}(n.current);x.value+=1,function(e,t){var n=t.gameState,i=t.size,o=t.densityFactor,r=t.assets,s=n.pos,a=n.elements,l=n.connections,u=n.focusElement,h=n.hoverElement,d=n.wireElement,p=n.options;function v(e){var t=a.find((function(t){return t.id===e}));if(!t)throw new Error("Element ".concat(e," is not found"));return t}e.save(),e.clearRect(0,0,i.width*o,i.height*o),1!==o&&e.scale(o,o),e.translate(Math.floor(i.width/2)+s.x,Math.floor(i.height/2)+s.y),p.debugDrawAxis&&(e.save(),e.lineWidth=1,e.textBaseline="middle",e.textAlign="center",e.font="15px sans-serif",e.fillStyle="#333",e.beginPath(),e.moveTo(0,0),e.lineTo(100,0),e.moveTo(95,-5),e.lineTo(100,0),e.moveTo(95,5),e.lineTo(100,0),e.strokeStyle="#0f0",e.stroke(),e.fillText("X",90,15),e.beginPath(),e.moveTo(0,0),e.lineTo(0,100),e.moveTo(-5,95),e.lineTo(0,100),e.moveTo(5,95),e.lineTo(0,100),e.strokeStyle="#00f",e.stroke(),e.fillText("Y",12,90),e.restore());var O,y=Object(S.a)(a);try{for(y.s();!(O=y.n()).done;){var b=O.value,E=b.pos,g=h&&h.type===m.ELEMENT&&b.id===h.elId,j=u&&u.type===m.ELEMENT&&u.elId===b.id;(g||j)&&(e.save(),g?(e.strokeStyle=j?"#7f7fff":"#e5e5e5",e.lineWidth=3):(e.strokeStyle="#bebeff",e.lineWidth=2),e.strokeRect(E.x-26,E.y-26,52,52),e.restore())}}catch($){y.e($)}finally{y.f()}var x,I=0,N=Object(S.a)(l);try{for(N.s();!(x=N.n()).done;){var P=Object(c.a)(x.value,2),T=P[0],k=P[1],M=v(T.elId),D=v(k.elId),C=w[M.type].pins[T.pinIndex],U=w[D.type].pins[k.pinIndex];e.save(),e.beginPath(),e.moveTo(M.pos.x-24+C.pos.x*K,M.pos.y-24+C.pos.y*K),e.lineTo(D.pos.x-24+U.pos.x*K,D.pos.y-24+U.pos.y*K);var R=h&&h.type===m.CONNECTION&&h.connectionIndex===I,L=u&&u.type===m.CONNECTION&&u.connectionIndex===I;e.lineWidth=R||L?3:1,e.strokeStyle=R&&L?"#8080ff":L?"#bfbfff":"#333",e.stroke(),e.restore(),I+=1}}catch($){N.e($)}finally{N.f()}if(d){var W=d.elId,V=d.pinIndex,A=v(W),G=w[A.type].pins[V].pos,F=G.x*K+A.pos.x-24,H=G.y*K+A.pos.y-24;if(d.pullPos){var B=d.pullPos,_=B.x,J=B.y;e.save(),e.beginPath(),e.moveTo(F,H),e.lineTo(_,J),e.strokeStyle="#888",e.stroke(),e.restore()}}var z,Y=Object(S.a)(a);try{var X=function(){var t=z.value,n=t.id,i=t.type,s=t.pos;if(i===f.INPUT||i===f.OUTPUT){var l=q(a.filter((function(e){return e.type===i})),t,i===f.INPUT?p.isInputVector:p.isOutputVector);e.save(),e.textAlign="center",e.textBaseline="middle",e.font="24px sans-serif",i===f.INPUT?e.fillText(l,s.x,s.y-10):e.fillText(l,s.x+6,s.y),e.restore()}else{var u,v=o>1.5?["x2","x1"]:["x1","x2"],O=Object(c.a)(v,2),y=O[0],b=O[1],E=null!==(u=r[y].images[i])&&void 0!==u?u:r[b].images[i];if(E){var g=s.x-24,j=s.y-24;e.drawImage(E,g,j,K,K)}}p.debugDrawId&&(e.textAlign="center",e.textBaseline="middle",e.font="16px sans-serif",e.fillText(n,s.x+24-6,s.y-24+6));var x,I=w[i].pins,N=0,P=Object(S.a)(I);try{for(P.s();!(x=P.n()).done;){var T=x.value,k=h&&h.type===m.ELEMENT&&h.elId===t.id&&h.activePin&&h.activePin.index===N,M=d&&d.elId===t.id&&d.pinIndex===N;e.beginPath(),e.arc(s.x+(T.pos.x-.5)*K,s.y+(T.pos.y-.5)*K,k?6:5,0,2*Math.PI),e.closePath(),k||M?(e.save(),e.fillStyle=M?"#d66":"#66d",e.fill(),e.restore()):(e.save(),e.fillStyle="#fff",e.fill(),e.strokeStyle="#448",e.lineWidth=2,e.stroke(),e.restore()),N+=1}}catch($){P.e($)}finally{P.f()}};for(Y.s();!(z=Y.n()).done;)X()}catch($){Y.e($)}finally{Y.f()}e.restore()}(e,{gameState:y.getState(),size:I,densityFactor:h.value,assets:N})}})),M=Object(i.useMemo)((function(){var e=1e3/60;return Object(b.a)(k,e,{maxWait:e,leading:!0,trailing:!0})}),[k]);function D(){var e=o.current,t=n.current;if(!e||!t)throw new Error;I.width=e.clientWidth,I.height=e.clientHeight,t.width=I.width*h.value,t.height=I.height*h.value,M()}return Object(i.useEffect)((function(){return y.setDrawHandler(M),function(){y.setDrawHandler(void 0)}}),[]),Object(i.useLayoutEffect)(D,[h.value]),v("resize",(function(){setTimeout((function(){T(),D()}),0)})),Object(te.jsxs)(Ne,{children:[Object(te.jsxs)(Pe,{ref:o,children:[Object(te.jsx)(Te,{ref:n,enableScaling:1!==h.value,width:0,height:0,style:{"--factor":1/h.value,cursor:g},onClick:function(e){0===e.button&&e.preventDefault()},onMouseDown:function(e){0===e.button&&(e.preventDefault(),y.onMouseDown())},onMouseMove:function(e){y.onMouseMove({position:P({x:e.clientX,y:e.clientY}),movement:{x:e.movementX,y:e.movementY}})},onMouseUp:function(e){0===e.button&&(e.preventDefault(),y.onMouseUp())},onMouseLeave:function(){y.resetCursorState()},onContextMenu:function(e){y.allowOpenContextMenu()||e.preventDefault()}}),j&&Object(te.jsx)(ke,{children:l})]}),Object(te.jsx)(Oe,{gameModel:y}),Object(te.jsx)(pe,{gameModel:y}),Object(te.jsxs)(De,{children:[Object(te.jsx)(je,{gameModel:y}),Object(te.jsx)(ie,{gameModel:y}),Object(te.jsx)(re,{gameModel:y}),Object(te.jsx)(Me,{}),Object(te.jsx)(Se,{gameModel:y})]})]})}var Re=h("div",{padding:16}),Le=h("h1",{margin:0}),We=h("h2",{fontVariant:"18|24"}),Ve=h("button",{marginLeft:16});function Ae(e){var t,n=(null!==(t=window.location.hash)&&void 0!==t?t:"").trim().replace(/^#/,"");if(n){var i=n.match(/^g(\d+)$/);if(i){var o=i[0];if(e.includes(o))return o}}}function Ge(){var e=Object(i.useMemo)((function(){var e=localStorage.getItem("sch_games");return e?JSON.parse(e):[]}),[]),t=Object(i.useState)(e),n=Object(c.a)(t,2),o=n[0],r=n[1];!function(e,t){var n=Object(i.useRef)(!1);Object(i.useEffect)((function(){n.current?e():n.current=!0}),t)}((function(){localStorage.setItem("sch_games",JSON.stringify(o))}),[o]);var s=Object(i.useState)(Ae(o)),l=Object(c.a)(s,2),u=l[0],h=l[1];return v("hashchange",(function(){var e=Ae(o);e!==u&&h(e)})),u?Object(te.jsx)(Ue,{gameId:u},u):Object(te.jsxs)(Re,{children:[Object(te.jsx)(Le,{children:"Schematic"}),Object(te.jsx)(We,{children:"Current schemas:"}),Object(te.jsx)("ul",{children:o.length?o.map((function(e){return Object(te.jsxs)("li",{children:[Object(te.jsx)("a",{href:"#".concat(e),children:e})," ",Object(te.jsx)(Ve,{type:"button",onClick:function(t){t.preventDefault(),window.confirm("Are you sure?")&&(r(o.filter((function(t){return t!==e}))),localStorage.removeItem("sch_game_".concat(e)))},children:"x"})]},e)})):Object(te.jsx)("div",{children:"no saved schemas"})}),Object(te.jsx)("button",{type:"button",onClick:function(e){e.preventDefault();var t=function(e){var t=e[e.length-1];if(!t)return"g1";var n=t.match(/^g(\d+)$/);if(!n)throw new Error;return"g".concat(parseInt(n[1],10)+1)}(o);r([].concat(Object(a.a)(o),[t])),window.setTimeout((function(){window.location.assign("#".concat(t))}),0)},children:"New schema"})]})}s.a.render(Object(te.jsx)(o.a.StrictMode,{children:Object(te.jsx)(Ge,{})}),document.getElementById("root"))}},[[54,1,2]]]);
//# sourceMappingURL=main.9e262b61.chunk.js.map