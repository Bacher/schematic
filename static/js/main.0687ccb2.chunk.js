(this.webpackJsonpschematic=this.webpackJsonpschematic||[]).push([[0],{10:function(e,t,n){e.exports={wrapper:"App_wrapper__1Jn2B",title:"App_title__2C-7r",gamesTitle:"App_gamesTitle__zqWFJ",removeButton:"App_removeButton__1M5gF"}},14:function(e,t,n){e.exports={title:"SchemaErrors_title__DGpx-"}},19:function(e,t,n){},2:function(e,t,n){e.exports={app:"Emulator_app__T00XQ",panel:"Emulator_panel__NbdHB",button:"Emulator_button__3x9P5",canvasWrapper:"Emulator_canvasWrapper__1jUgz",canvas:"Emulator_canvas__18vZ6",info:"Emulator_info__XN-lN",divider:"Emulator_divider__1O1xo",space:"Emulator_space__3sZL6",yes:"Emulator_yes__2HVG8",no:"Emulator_no__3K5j9"}},21:function(e,t,n){"use strict";n.r(t);var r=n(1),c=n.n(r),a=n(13),o=n.n(a),s=(n(19),n(9)),i=n(5);function l(e,t){var n=Object(r.useRef)(!1);Object(r.useEffect)((function(){n.current?e():n.current=!0}),t)}function u(e){var t=function(e){var t=Object(r.useRef)(e);return t.current=e,t}(e);return Object(r.useCallback)((function(){return t.current.apply(t,arguments)}),[])}var d,p=n(12),v=n(3);function f(e){return Object(r.useRef)(e).current}!function(e){e.PNP="pnp",e.NPN="npn",e.POWER="power",e.GROUND="ground",e.INPUT="input",e.OUTPUT="output",e.DOT="dot"}(d||(d={}));var j,h=n(4),b=(j={},Object(h.a)(j,d.PNP,{pins:[{pos:{x:.47,y:.94}},{pos:{x:-.07,y:.32}},{pos:{x:1.05,y:.32}}]}),Object(h.a)(j,d.NPN,{pins:[{pos:{x:.47,y:1}},{pos:{x:-.07,y:.33}},{pos:{x:1.05,y:.32}}]}),Object(h.a)(j,d.POWER,{pins:[{pos:{x:.52,y:.8}}]}),Object(h.a)(j,d.GROUND,{pins:[{pos:{x:.46,y:.15}}]}),Object(h.a)(j,d.INPUT,{pins:[{pos:{x:.5,y:.8}}]}),Object(h.a)(j,d.OUTPUT,{pins:[{pos:{x:.2,y:.5}}]}),Object(h.a)(j,d.DOT,{pins:[{pos:{x:.5,y:.5}}]}),j),x="ABCDEFGHIJ",O="YZXWVUTSRQ";function m(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=e.indexOf(t),c=t.type===d.INPUT?x:O;return!n&&e.length<=c.length?c.charAt(r):t.type===d.INPUT?"I".concat(r):"Y".concat(r)}var g=n(6),y=n.n(g),I=n(0);function w(e){var t=e.elements,n=e.options,c=e.onOptionsChange,a=Object(r.useMemo)((function(){var e=t.filter((function(e){return e.type===d.INPUT})),r=t.filter((function(e){return e.type===d.OUTPUT})),c=e,a=r;return n.isInputVector&&(c=Object(s.a)(e).reverse()),n.isOutputVector&&(a=Object(s.a)(r).reverse()),{inputs:e,outputs:r,renderInputs:c,renderOutputs:a}}),[t.length,n.isInputVector,n.isOutputVector]),o=a.inputs,i=a.outputs,l=a.renderInputs,u=a.renderOutputs;return Object(I.jsxs)("div",{className:y.a.wrapper,children:[Object(I.jsxs)("div",{className:y.a.options,children:[Object(I.jsxs)("label",{className:y.a.option,children:[Object(I.jsx)("input",{type:"checkbox",checked:n.isInputVector,onChange:function(e){c({isInputVector:e.target.checked})}})," ","Treat input as vector"]}),Object(I.jsxs)("label",{className:y.a.option,children:[Object(I.jsx)("input",{type:"checkbox",checked:n.isOutputVector,onChange:function(e){c({isOutputVector:e.target.checked})}})," ","Treat output as vector"]})]}),Object(I.jsxs)("table",{className:y.a.table,children:[Object(I.jsx)("thead",{children:Object(I.jsxs)("tr",{children:[l.map((function(e,t){return Object(I.jsx)("th",{className:y.a.tableCell,children:m(o,e,n.isInputVector)},t)})),u.map((function(e,t){return Object(I.jsx)("th",{className:y.a.tableCell,children:m(i,e,n.isOutputVector)},t)}))]})}),Object(I.jsx)("tbody",{children:Array.from({length:Math.pow(2,o.length)}).map((function(e,t){return Object(I.jsxs)("tr",{children:[l.map((function(e,n){return Object(I.jsx)("td",{children:Math.floor(t/Math.pow(2,o.length-n-1))%2},n)})),u.map((function(e,t){return Object(I.jsx)("td",{children:"Z"},t)}))]},t)}))})]})]})}var N=n(14),_=n.n(N);function P(e){var t,n=e.state,r=[],c=Object(v.a)(n.elements);try{for(c.s();!(t=c.n()).done;){var a,o=t.value,s=b[o.type].pins.map((function(){return!1})),i=Object(v.a)(n.connections);try{for(i.s();!(a=i.n()).done;){var l,u=a.value,d=Object(v.a)(u);try{for(d.s();!(l=d.n()).done;){var p=l.value;p.elId===o.id&&(s[p.pinIndex]=!0)}}catch(f){d.e(f)}finally{d.f()}}}catch(f){i.e(f)}finally{i.f()}s.some((function(e){return!e}))&&r.push("Floating pins on node ".concat(o.type))}}catch(f){c.e(f)}finally{c.f()}return r.length?Object(I.jsxs)("div",{children:[Object(I.jsx)("h2",{className:_.a.title,children:"Errors:"}),r.map((function(e,t){return Object(I.jsx)("div",{children:e},t)}))]}):null}var T=n(2),D=n.n(T),k=48,E=52;function M(e){var t=e.elements[e.elements.length-1];if(!t)return"el1";var n=t.id.match(/^el(\d+)$/);return"el".concat(parseInt(n[1],10)+1)}function C(e){var t,n=e.gameId,c=Object(r.useRef)(null),a=Object(r.useRef)(null),o=function(){var e=Object(r.useRef)(0),t=Object(r.useState)(e.current),n=Object(i.a)(t,2)[1];return Object(r.useCallback)((function(){n(++e.current)}),[])}(),s=Object(r.useState)(),j=Object(i.a)(s,2),h=j[0],x=j[1],O=Object(r.useState)({isInputVector:!1,isOutputVector:!1}),g=Object(i.a)(O,2),y=g[0],N=g[1],_=u((function(){var e=localStorage.getItem("sch_game_".concat(n));if(e){var t=JSON.parse(e),r=t.pos,c=t.elements,a=t.connections,o=t.options;F(),C.x=r.x,C.y=r.y,J.elements=c,J.connections=a,N(o),window.setTimeout(X,0)}}));Object(r.useEffect)((function(){_();var e=window.setInterval(o,500);return function(){window.clearInterval(e)}}),[]);var T=f({width:0,height:0}),C=f({x:0,y:0}),U=f({}),R=f({x:0,y:0}),V=f({target:void 0}),W=f({elId:void 0}),A=f({target:void 0}),B=f({source:void 0}),J=f({elements:[],connections:[]}),G=f({isMouseDown:!1,isDrag:!1});window.state=J;var L=u((function(e){var t=J.elements.find((function(t){return t.id===e}));if(!t)throw new Error("Element not found");return t})),X=u((function(){var e,t=c.current.getContext("2d");if(!t)throw new Error;t.clearRect(0,0,T.width,T.height),t.save(),t.translate(T.width/2+C.x+.5,T.height/2+C.y+.5);var n,r=Object(v.a)(J.elements);try{for(r.s();!(n=r.n()).done;){var a,o=n.value,s=o.pos;o.id===(null===(a=V.target)||void 0===a?void 0:a.elId)?(t.save(),t.strokeStyle="#ddf",t.lineWidth=3,t.strokeRect(s.x-26,s.y-26,E,E),t.restore()):o.id===W.elId&&(t.save(),t.strokeStyle="#ededf3",t.lineWidth=2,t.strokeRect(s.x-26,s.y-26,E,E),t.restore())}}catch(Q){r.e(Q)}finally{r.f()}var l,u=Object(v.a)(J.connections);try{for(u.s();!(l=u.n()).done;){var p=Object(i.a)(l.value,2),f=p[0],j=p[1],O=L(f.elId),g=L(j.elId),I=b[O.type].pins[f.pinIndex],w=b[g.type].pins[j.pinIndex];t.save(),t.beginPath(),t.moveTo(O.pos.x-24+I.pos.x*k,O.pos.y-24+I.pos.y*k),t.lineTo(g.pos.x-24+w.pos.x*k,g.pos.y-24+w.pos.y*k),t.strokeStyle="#333",t.stroke(),t.restore()}}catch(Q){u.e(Q)}finally{u.f()}if(B.source){var N=B.source,_=N.elId,P=N.pinIndex,D=L(_),M=b[D.type].pins[P].pos,S=M.x*k+D.pos.x-24,A=M.y*k+D.pos.y-24,X=H(R),Y=X.x,Z=X.y;t.save(),t.beginPath(),t.moveTo(S,A),t.lineTo(Y,Z),t.strokeStyle="#888",t.stroke(),t.restore()}var z,F,$=Object(v.a)(J.elements);try{var q=function(){var e=z.value,n=e.type,r=e.pos;if(n===d.INPUT||n===d.OUTPUT){var c=m(J.elements.filter((function(e){return e.type===n})),e,n===d.INPUT?y.isInputVector:y.isOutputVector);t.save(),t.textAlign="center",t.textBaseline="middle",t.font="24px sans-serif",n===d.INPUT?t.fillText(c,r.x,r.y-10):t.fillText(c,r.x+6,r.y),t.restore()}else{var a=U[n];if(a){var o=r.x-24,s=r.y-24;t.drawImage(a,o,s,k,k)}}var i,l=b[n].pins,u=V.target,p=0,f=Object(v.a)(l);try{for(f.s();!(i=f.n()).done;){var j=i.value,h=u&&e.id===u.elId&&u.activePin&&u.activePin.index===p,x=B.source&&B.source.elId===e.id&&B.source.pinIndex===p;t.beginPath(),t.arc(r.x+(j.pos.x-.5)*k,r.y+(j.pos.y-.5)*k,h?6:5,0,2*Math.PI),t.closePath(),h||x?(t.save(),t.fillStyle=x?"#d66":"#66d",t.fill(),t.restore()):(t.save(),t.fillStyle="#fff",t.fill(),t.strokeStyle="#448",t.lineWidth=2,t.stroke(),t.restore()),p++}}catch(Q){f.e(Q)}finally{f.f()}};for($.s();!(z=$.n()).done;)q()}catch(Q){$.e(Q)}finally{$.f()}t.restore(),B.source||(null===(e=V.target)||void 0===e?void 0:e.activePin)?F="pointer":V.target?F="move":G.isDrag&&(F="grabbing"),F!==h&&x(F)}));function H(e){var t=e.x,n=e.y;return{x:t-T.width/2-C.x,y:n-T.height/2-C.y}}function Y(){setTimeout((function(){var e=a.current,t=c.current;T.width=e.clientWidth,T.height=e.clientHeight,t.width=T.width,t.height=T.height,X()}),0)}function Z(e){var t,n=Object(v.a)(J.elements);try{for(n.s();!(t=n.n()).done;){var r=t.value.pos;if(Math.pow(r.x-e.x,2)+Math.pow(r.y-e.y,2)<Math.pow(24,2))return!0}}catch(c){n.e(c)}finally{n.f()}return!1}function z(e){for(var t=H({x:T.width/2,y:T.height/2});Z(t);)t.x+=68;J.elements.push({type:e,id:M(J),pos:t}),X()}function F(){C.x=0,C.y=0,J.elements=[],J.connections=[],V.target=void 0,W.elId=void 0,A.target=void 0,B.source=void 0,G.isDrag=!1,G.isMouseDown=!1}function $(e){var t=e.elId,n=e.pinIndex;W.elId=t,B.source={elId:t,pinIndex:n}}Object(r.useEffect)((function(){Y(),window.addEventListener("resize",Y),function(){var e=[d.PNP,d.NPN,d.POWER,d.GROUND],t=e.length;function n(){0===--t&&X()}for(var r=0,c=e;r<c.length;r++){var a=c[r],o=new Image;o.src="assets/".concat(a,".png"),o.addEventListener("load",n),U[a]=o}}()}),[]),l(X,[y]);var q=u((function(e){if(!e||(e.preventDefault(),0===e.button)){var t=!1;if(G.isMouseDown=!1,!W.elId||B.source||A.target||(W.elId=void 0,t=!0),A.target&&(A.target=void 0,t=!0),G.isDrag&&(G.isDrag=!1,t=!0),B.source){var n=V.target;n&&n.activePin&&B.source.elId!==n.elId&&J.connections.push([{elId:n.elId,pinIndex:n.activePin.index},{elId:B.source.elId,pinIndex:B.source.pinIndex}]),B.source=void 0,t=!0}else if(!B.source){var r=V.target;r&&r.activePin&&($({elId:r.elId,pinIndex:r.activePin.index}),t=!0),r&&!r.activePin&&W.elId!==r.elId&&(W.elId=r.elId,t=!0)}t&&X()}}));return Object(I.jsxs)("main",{className:D.a.app,children:[Object(I.jsx)("div",{ref:a,className:D.a.canvasWrapper,children:Object(I.jsx)("canvas",{ref:c,className:D.a.canvas,style:h?{cursor:h}:void 0,onClick:function(e){e.preventDefault()},onMouseDown:function(e){e.preventDefault(),0===e.button&&(G.isMouseDown&&q(),G.isMouseDown=!0)},onMouseMove:function(e){R.x=e.clientX,R.y=e.clientY;var t=!1;(function(){var e,t=H(R),n=t.x,r=t.y,c=V.target,a=Object(v.a)(J.elements);try{for(a.s();!(e=a.n()).done;){var o,s=e.value,i=b[s.type].pins,l=s.pos.x-24,u=s.pos.y-24,d=Object(v.a)(i);try{for(d.s();!(o=d.n()).done;){var p=o.value;if(Math.pow(l+p.pos.x*k-n,2)+Math.pow(u+p.pos.y*k-r,2)<Math.pow(9,2)){var f,j=i.indexOf(p),h=V.target;return(!h||h.elId!==s.id||(null===(f=h.activePin)||void 0===f?void 0:f.index)!==j)&&(V.target={elId:s.id,activePin:{index:j}},!0)}}}catch(I){d.e(I)}finally{d.f()}}}catch(I){a.e(I)}finally{a.f()}var x,O=Object(v.a)(J.elements);try{for(O.s();!(x=O.n()).done;){var m=x.value,g=m.pos.x-24,y=m.pos.y-24;if(n>g&&n<g+k&&r>y&&r<y+k)return!(c&&c.elId===m.id&&!c.activePin)&&(V.target={elId:m.id,activePin:void 0},!0)}}catch(I){O.e(I)}finally{O.f()}return!!V.target&&(V.target=void 0,!0)})()&&(t=!0);var n=Boolean(A.target),r=V.target;if(G.isMouseDown){if(!n&&!B.source&&r&&r.activePin&&($({elId:r.elId,pinIndex:r.activePin.index}),t=!0),!n&&B.source&&(t=!0),n||B.source||!r||(A.target={elId:r.elId},W.elId=r.elId,t=!0),B.source||A.target||G.isDrag||(G.isDrag=!0,t=!0),A.target){var c=L(A.target.elId);c.pos.x+=e.movementX,c.pos.y+=e.movementY}else B.source||(C.x+=e.movementX,C.y+=e.movementY);t=!0}else G.isDrag&&(G.isDrag=!1,t=!0);B.source&&(t=!0),t&&X()},onMouseUp:q,onMouseLeave:function(){(function(){var e=!1;return G.isMouseDown&&(G.isMouseDown=!1),A.target&&(A.target=void 0,e=!0),G.isDrag&&(G.isDrag=!1,e=!0),B.source&&(B.source=void 0,e=!0),e})()&&X()},onContextMenu:function(e){(V.target||B.source||G.isDrag)&&e.preventDefault()}})}),Object(I.jsxs)("div",{className:D.a.panel,children:[Object(I.jsx)("button",{className:D.a.button,onClick:function(){z(d.POWER)},children:"DD"}),Object(I.jsx)("button",{className:D.a.button,onClick:function(){z(d.GROUND)},children:"GND"}),Object(I.jsx)("button",{className:D.a.button,onClick:function(){z(d.NPN)},children:"npn"}),Object(I.jsx)("button",{className:D.a.button,onClick:function(){z(d.PNP)},children:"pnp"}),Object(I.jsx)("button",{className:D.a.button,onClick:function(){z(d.INPUT)},children:"input"}),Object(I.jsx)("button",{className:D.a.button,onClick:function(){z(d.OUTPUT)},children:"output"}),Object(I.jsx)("button",{className:D.a.button,onClick:function(){z(d.DOT)},children:"dot"}),Object(I.jsx)("span",{className:D.a.divider}),Object(I.jsx)("button",{className:D.a.button,onClick:function(e){e.preventDefault(),_()},children:"Load"}),Object(I.jsx)("button",{className:D.a.button,onClick:function(){localStorage.setItem("sch_game_".concat(n),JSON.stringify({pos:C,elements:J.elements,connections:J.connections,options:y})),console.info("Saved")},children:"Save"}),Object(I.jsx)("button",{className:D.a.button,onClick:function(){F(),X()},children:"Clear"}),Object(I.jsx)("a",{href:"#",children:Object(I.jsx)("button",{className:D.a.button,children:"Exit"})})]}),Object(I.jsxs)("div",{className:D.a.info,children:[Object(I.jsx)(w,{elements:J.elements,options:y,onOptionsChange:function(e){return N(Object(p.a)(Object(p.a)({},y),e))}}),Object(I.jsx)(P,{state:J}),Object(I.jsx)("span",{className:D.a.space}),Object(I.jsxs)("div",{className:D.a.debugPanel,children:[Object(I.jsxs)("div",{children:["elements: ",J.elements.length]}),Object(I.jsxs)("div",{children:["connections: ",J.connections.length]}),Object(I.jsxs)("div",{children:["el moving: ",S(A.target)]}),Object(I.jsxs)("div",{children:["el in focus: ",S(W.elId)]}),Object(I.jsxs)("div",{children:["el hover: ",S(V.target)]}),Object(I.jsxs)("div",{children:["pin hover: ",S(null===(t=V.target)||void 0===t?void 0:t.activePin)]}),Object(I.jsxs)("div",{children:["wiring: ",S(B.source)]}),Object(I.jsxs)("div",{children:["drag: ",S(G.isDrag)]}),Object(I.jsxs)("div",{children:["mouse down: ",S(G.isMouseDown)]})]})]})]})}function S(e){return e?Object(I.jsx)("span",{className:D.a.yes,children:"yes"}):Object(I.jsx)("span",{className:D.a.no,children:"no"})}var U=n(10),R=n.n(U);function V(e){var t,n=(null!==(t=window.location.hash)&&void 0!==t?t:"").trim().replace(/^#/,"");if(n){var r=n.match(/^g(\d+)$/);if(r){var c=r[0];if(e.includes(c))return c}}}function W(){var e=Object(r.useMemo)((function(){var e=localStorage.getItem("sch_games");return e?JSON.parse(e):[]}),[]),t=Object(r.useState)(e),n=Object(i.a)(t,2),c=n[0],a=n[1];l((function(){localStorage.setItem("sch_games",JSON.stringify(c))}),[c]);var o=Object(r.useState)(V(c)),d=Object(i.a)(o,2),p=d[0],v=d[1];return function(e,t){var n=u(t);Object(r.useEffect)((function(){return window.addEventListener(e,n,!1),function(){window.removeEventListener(e,n,!1)}}),[])}("hashchange",(function(){var e=V(c);e!==p&&v(e)})),p?Object(I.jsx)(C,{gameId:p},p):Object(I.jsxs)("div",{className:R.a.wrapper,children:[Object(I.jsx)("h1",{className:R.a.title,children:"Schematic"}),Object(I.jsx)("h2",{className:R.a.gamesTitle,children:"Current schemas:"}),Object(I.jsx)("ul",{children:c.length?c.map((function(e){return Object(I.jsxs)("li",{children:[Object(I.jsx)("a",{href:"#".concat(e),children:e})," ",Object(I.jsx)("button",{type:"button",className:R.a.removeButton,onClick:function(t){t.preventDefault(),window.confirm("Are you sure?")&&(a(c.filter((function(t){return t!==e}))),localStorage.removeItem("sch_game_".concat(e)))},children:"x"})]},e)})):Object(I.jsx)("div",{children:"no saved schemas"})}),Object(I.jsx)("button",{type:"button",onClick:function(e){e.preventDefault();var t=function(e){var t=e[e.length-1];if(!t)return"g1";var n=t.match(/^g(\d+)$/);return"g".concat(parseInt(n[1],10)+1)}(c);a([].concat(Object(s.a)(c),[t])),window.setTimeout((function(){window.location.assign("#".concat(t))}),0)},children:"New schema"})]})}o.a.render(Object(I.jsx)(c.a.StrictMode,{children:Object(I.jsx)(W,{})}),document.getElementById("root"))},6:function(e,t,n){e.exports={wrapper:"TruthTable_wrapper__23wrn",options:"TruthTable_options__kzZt2",option:"TruthTable_option__1Hqnt"}}},[[21,1,2]]]);
//# sourceMappingURL=main.0687ccb2.chunk.js.map