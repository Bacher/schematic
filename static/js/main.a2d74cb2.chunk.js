(this.webpackJsonpschematic=this.webpackJsonpschematic||[]).push([[0],{51:function(e,t,n){},54:function(e,t,n){"use strict";n.r(t);var i,o,r,s=n(1),a=n.n(s),c=n(41),l=n.n(c),u=(n(50),n(51),n(4)),d=n(3),h=n(56),p=n(45),f=Object(p.a)({theme:{colors:{gray400:"gainsboro",gray500:"lightgray"}},media:{bp1:"(min-width: 480px)",bp2:"(min-width: 768px)"},utils:{fontVariant:function(e){var t=e.split("|"),n=Object(d.a)(t,2),i=n[0],o=n[1];return{fontSize:"".concat(i,"px"),lineHeight:"".concat(o,"px")}}}}),v=f.styled,m=(f.css,f.globalCss,f.keyframes,f.getCssText,f.theme,f.createTheme,f.config,n(2)),O=n(10),y=n(26),b=n(27),g=n(7),j=n(55),E=n(58),x=n(59),I=n(57),w=n(37),S=n(25),N=n.n(S);!function(e){e.PNP="pnp",e.NPN="npn",e.POWER="power",e.GROUND="ground",e.INPUT="input",e.OUTPUT="output",e.DOT="dot"}(i||(i={})),function(e){e[e.ELEMENT=0]="ELEMENT",e[e.CONNECTION=1]="CONNECTION",e[e.PIN=2]="PIN"}(o||(o={})),function(e){e[e.NONE=0]="NONE",e[e.LOADING=1]="LOADING",e[e.DONE=2]="DONE"}(r||(r={}));var P,k,T,D=n(6),C=48,M=(P={},Object(D.a)(P,i.PNP,{pins:[{pos:{x:.47,y:.94}},{pos:{x:-.07,y:.32}},{pos:{x:1.05,y:.32}}]}),Object(D.a)(P,i.NPN,{pins:[{pos:{x:.47,y:1}},{pos:{x:-.07,y:.33}},{pos:{x:1.05,y:.32}}]}),Object(D.a)(P,i.POWER,{pins:[{pos:{x:.52,y:.8}}]}),Object(D.a)(P,i.GROUND,{pins:[{pos:{x:.46,y:.15}}]}),Object(D.a)(P,i.INPUT,{pins:[{pos:{x:.5,y:.8}}]}),Object(D.a)(P,i.OUTPUT,{pins:[{pos:{x:.2,y:.5}}]}),Object(D.a)(P,i.DOT,{pins:[{pos:{x:.5,y:.5}}]}),P),U={autoSaves:!0,isInputVector:!1,isOutputVector:!1,simulate:!1,debugDrawId:!1,debugDrawAxis:!1,debugShowFps:!1};function R(e,t){return{x:e.x-t.x,y:e.y-t.y}}function L(e,t){var n=Math.sin(t),i=Math.cos(t);return{x:e.x*i-e.y*n,y:e.x*n+e.y*i}}function G(e){return"".concat(e.elId,":").concat(e.pinIndex)}function W(){var e=Object(s.useRef)(0),t=Object(s.useState)(e.current),n=Object(d.a)(t,2)[1];return Object(s.useCallback)((function(){e.current+=1,n(e.current)}),[])}function A(e){var t=Object(s.useRef)(e);return t.current=e,t}function H(e){var t=A(e);return Object(s.useCallback)((function(){return t.current.apply(t,arguments)}),[])}function V(e,t){return e.filter((function(e,n){return n!==t}))}function F(e){return"sch_game_".concat(e)}function B(e,t,n){var i=n.value;n.value=function(){if(!(this instanceof J))throw new Error;var e=!1;this.underWatch||(e=!0,this.underWatch=!0);for(var t=this.getState(),n=arguments.length,o=new Array(n),r=0;r<n;r++)o[r]=arguments[r];var s=i.apply(this,o);if(e){if(!this.needTriggerUpdate){var a=this.getState();this.needTriggerUpdate=t!==a}this.needTriggerUpdate&&(this.needTriggerUpdate=!1,this.triggerUpdate()),this.underWatch=!1}return s}}function _(e,t,n){var i=n.value;n.value=function(){if(!(this instanceof J))throw new Error;for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var o=i.apply(this,t);return this.underWatch?this.needTriggerUpdate=!0:this.triggerUpdate(),o}}!function(e){e[e.IMPEDANCE=0]="IMPEDANCE",e[e.GROUND=1]="GROUND",e[e.POWER=2]="POWER",e[e.SHORT_CIRCUIT=3]="SHORT_CIRCUIT"}(k||(k={}));var J=(T=function(){function e(t){var n=t.gameId,i=t.elements,o=t.connections,r=t.inputSignals,s=t.pos,a=t.options;Object(y.a)(this,e),this.underWatch=!1,this.needTriggerUpdate=!1,this.gameId=void 0,this.drawHandler=void 0,this.destroying=!1,this.elements=void 0,this.connections=void 0,this.inputSignals=void 0,this.pos=void 0,this.options=void 0,this.hoverElement=void 0,this.focusElement=void 0,this.wireElement=void 0,this.movingElement=void 0,this.mousePos=void 0,this.mouseState=void 0,this.panState=void 0,this.lastStateSnapshot=void 0,this.stateListeners=void 0,this.saveGameThrottled=Object(j.a)(this.saveGame,2e3,{leading:!1,trailing:!0}),this.gameId=n,this.elements=i,this.connections=o,this.inputSignals=r,this.pos=s,this.options=a,window.gameModel=this,this.hoverElement=void 0,this.focusElement=void 0,this.wireElement=void 0,this.movingElement=void 0,this.mouseState={isMouseDown:!1},this.panState={isPan:!1},this.mousePos=void 0,this.stateListeners=[],this.lastStateSnapshot=void 0}return Object(b.a)(e,[{key:"destroy",value:function(){this.destroying=!0,this.saveGameThrottled.flush(),this.clearState(),this.drawHandler=void 0}},{key:"setDrawHandler",value:function(e){this.drawHandler=e}},{key:"saveGame",value:function(){localStorage.setItem(F(this.gameId),JSON.stringify({pos:this.pos,elements:this.elements,inputSignals:this.inputSignals,connections:this.connections,options:this.options}))}},{key:"getState",value:function(){var e={elements:this.elements,connections:this.connections,inputSignals:this.inputSignals,pos:this.pos,options:this.options,hoverElement:this.hoverElement,focusElement:this.focusElement,wireElement:this.wireElement,movingElement:this.movingElement,panState:this.panState};return this.lastStateSnapshot&&N()(e,this.lastStateSnapshot.cmpState)||(this.lastStateSnapshot={cmpState:e,state:Object(O.a)(Object(O.a)({},e),{},{cursor:this.getCursor(),nodesSimulation:this.getSimulation()})}),this.lastStateSnapshot.state}},{key:"deleteElementInFocus",value:function(){var e=this.focusElement;if(e){switch(e.type){case o.ELEMENT:this.connections=this.connections.filter((function(t){var n=Object(d.a)(t,2),i=n[0],o=n[1];return i.elId!==e.elId&&o.elId!==e.elId}));var t=this.elements.find((function(t){return t.id===e.elId}));if(!t)throw new Error;if(t.type===i.INPUT){var n=this.elements.filter((function(e){return e.type===i.INPUT})).indexOf(t);this.inputSignals=V(this.inputSignals,n)}this.elements=Object(E.a)(this.elements,t);break;case o.CONNECTION:this.connections=V(this.connections,e.connectionIndex)}this.focusElement=void 0}}},{key:"updateInputSignals",value:function(e){this.inputSignals=e}},{key:"updateOptions",value:function(e){this.options=e}},{key:"onMouseDown",value:function(){this.mouseState.isMouseDown&&this.onMouseUp(),this.mouseState.isMouseDown=!0}},{key:"onMouseMove",value:function(e){var t=this,n=e.position,i=n.x,r=n.y,s=e.movement,a=s.x,c=s.y;this.mousePos={x:i,y:r},this.checkHover();var l=Boolean(this.movingElement);if(this.mouseState.isMouseDown){l||this.wireElement||!this.hoverElement||this.hoverElement.type!==o.PIN||this.startWiring({elId:this.hoverElement.elId,pinIndex:this.hoverElement.pinIndex}),l||this.wireElement||!this.hoverElement||this.hoverElement.type!==o.ELEMENT||(this.movingElement={elId:this.hoverElement.elId},this.focusElement={type:o.ELEMENT,elId:this.hoverElement.elId}),this.wireElement||this.movingElement||this.panState.isPan||(this.panState={isPan:!0});var u=this.movingElement;u?this.updateElement(u.elId,(function(e){e.pos.x+=a,e.pos.y+=c})):this.wireElement||(this.pos={x:this.pos.x+a,y:this.pos.y+c})}else this.panState.isPan&&(this.panState={isPan:!1});this.wireElement&&(this.wireElement=Object(w.a)(this.wireElement,(function(e){if(t.mousePos){var n=t.mousePos.x-t.pos.x,i=t.mousePos.y-t.pos.y;e.pullPos?(e.pullPos.x=n,e.pullPos.y=i):e.pullPos={x:n,y:i}}else e.pullPos=void 0})))}},{key:"onMouseUp",value:function(){this.mouseState={isMouseDown:!1},!this.focusElement||this.wireElement||this.movingElement||(this.focusElement=void 0),this.movingElement&&(this.movingElement=void 0),this.panState.isPan&&(this.panState={isPan:!1}),this.wireElement?(this.hoverElement&&this.hoverElement.type===o.PIN&&this.wireElement.elId!==this.hoverElement.elId&&(this.connections=[].concat(Object(u.a)(this.connections),[[{elId:this.hoverElement.elId,pinIndex:this.hoverElement.pinIndex},{elId:this.wireElement.elId,pinIndex:this.wireElement.pinIndex}]])),this.wireElement=void 0):this.wireElement||(this.hoverElement&&this.hoverElement.type===o.PIN&&this.startWiring({elId:this.hoverElement.elId,pinIndex:this.hoverElement.pinIndex}),this.hoverElement&&(this.hoverElement.type===o.ELEMENT?this.focusElement&&this.focusElement.type===o.ELEMENT&&this.focusElement.elId===this.hoverElement.elId||(this.focusElement={type:o.ELEMENT,elId:this.hoverElement.elId}):this.hoverElement.type===o.CONNECTION&&(this.focusElement&&this.focusElement.type===o.CONNECTION&&this.focusElement.connectionIndex===this.hoverElement.connectionIndex||(this.focusElement={type:o.CONNECTION,connectionIndex:this.hoverElement.connectionIndex}))))}},{key:"getCursor",value:function(){var e=this.wireElement,t=this.hoverElement,n=this.panState;if(e)return"pointer";if(t){switch(t.type){case o.PIN:case o.CONNECTION:return"pointer";case o.ELEMENT:return"move"}if(n.isPan)return"grabbing"}else if(n.isPan)return"move";return"initial"}},{key:"addElement",value:function(e){for(var t=Object(O.a)({},this.pos);this.checkOverlap(t);)t.x+=68;this.elements=[].concat(Object(u.a)(this.elements),[{type:e,id:this.getNextId(),pos:t}]),e===i.INPUT&&(this.inputSignals=[].concat(Object(u.a)(this.inputSignals),[!1]))}},{key:"startWiring",value:function(e){var t=e.elId,n=e.pinIndex;this.focusElement={type:o.ELEMENT,elId:t},this.wireElement={elId:t,pinIndex:n,pullPos:this.mousePos}}},{key:"resetCursorState",value:function(){this.movingElement=void 0,this.wireElement=void 0,this.mouseState.isMouseDown&&(this.mouseState={isMouseDown:!1}),this.panState.isPan&&(this.panState={isPan:!1})}},{key:"triggerUpdate",value:function(){if(!this.destroying){this.drawHandler&&this.drawHandler(),this.saveGameThrottled();var e,t=this.getState(),n=Object(m.a)(this.stateListeners);try{for(n.s();!(e=n.n()).done;){e.value.isActual=!1}}catch(h){n.e(h)}finally{n.f()}var i,o=Object(m.a)(this.stateListeners);try{for(o.s();!(i=o.n()).done;){var r=i.value;if(!r.isActual){var s=r.forceUpdate,a=r.selector,c=r.lastSelectedValue,l=a(t);N()(l,c)||(r.actualSelectedValue={value:l},s())}}}catch(h){o.e(h)}finally{o.f()}var u,d=Object(m.a)(this.stateListeners);try{for(d.s();!(u=d.n()).done;){u.value.actualSelectedValue=void 0}}catch(h){d.e(h)}finally{d.f()}}}},{key:"clearState",value:function(){this.pos={x:0,y:0},this.elements=[],this.connections=[],this.inputSignals=[],this.hoverElement=void 0,this.focusElement=void 0,this.movingElement=void 0,this.wireElement=void 0,this.panState.isPan=!1,this.mouseState.isMouseDown=!1}},{key:"reloadFromSave",value:function(){try{var t=e.getLoadedState(this.gameId),n=t.elements,i=t.connections,o=t.pos,r=t.options,s=t.inputSignals;this.clearState(),this.elements=n,this.connections=i,this.pos=o,this.options=r,this.inputSignals=s}catch(a){console.error("Can't load state:",a)}}},{key:"updateElement",value:function(e,t){this.elements=Object(w.a)(this.elements,(function(n){var i=n.find((function(t){return t.id===e}));if(!i)throw new Error("Element ".concat(e," is not found"));t(i)}))}},{key:"checkHover",value:function(){if(this.mousePos){var e=R(this.mousePos,this.pos),t=this.checkPinHover(e)||this.checkElementHover(e)||this.checkConnectionHover(e);N()(this.hoverElement,t)||(this.hoverElement=t)}else this.hoverElement=void 0}},{key:"checkPinHover",value:function(e){var t,n=e.x,i=e.y,r=Object(m.a)(this.elements);try{for(r.s();!(t=r.n()).done;){var s,a=t.value,c=M[a.type].pins,l=a.pos.x-24,u=a.pos.y-24,d=Object(m.a)(c);try{for(d.s();!(s=d.n()).done;){var h=s.value;if(Math.pow(l+h.pos.x*C-n,2)+Math.pow(u+h.pos.y*C-i,2)<Math.pow(9,2))return{type:o.PIN,elId:a.id,pinIndex:c.indexOf(h)}}}catch(p){d.e(p)}finally{d.f()}}}catch(p){r.e(p)}finally{r.f()}}},{key:"checkElementHover",value:function(e){var t,n=e.x,i=e.y,r=Object(m.a)(this.elements);try{for(r.s();!(t=r.n()).done;){var s=t.value,a=s.pos.x-24,c=s.pos.y-24;if(n>a&&n<a+C&&i>c&&i<c+C)return{type:o.ELEMENT,elId:s.id}}}catch(l){r.e(l)}finally{r.f()}}},{key:"checkConnectionHover",value:function(e){var t,n=e.x,i=e.y,r=Object(m.a)(this.connections);try{for(r.s();!(t=r.n()).done;){var s=t.value,a=Object(d.a)(s,2),c=a[0],l=a[1],u=this.getConnectionPinPosition(c),h=R(this.getConnectionPinPosition(l),u),p=R({x:n,y:i},u),f=Math.atan2(h.y,h.x),v=L(h,-f),O=L(p,-f);if(O.x>=-10&&O.x<=v.x+10&&O.y>-10&&O.y<10)return{type:o.CONNECTION,connectionIndex:this.connections.indexOf(s)}}}catch(y){r.e(y)}finally{r.f()}}},{key:"applyHoverElement",value:function(e){N()(this.hoverElement,e)||(this.hoverElement=e)}},{key:"getConnectionPinPosition",value:function(e){var t=e.elId,n=e.pinIndex,i=this.getElById(t),o=M[i.type].pins[n];return{x:i.pos.x+(o.pos.x-.5)*C,y:i.pos.y+(o.pos.y-.5)*C}}},{key:"getElById",value:function(e){var t=this.elements.find((function(t){return t.id===e}));if(!t)throw new Error("Element not found");return t}},{key:"checkOverlap",value:function(e){var t,n=Object(m.a)(this.elements);try{for(n.s();!(t=n.n()).done;){var i=t.value.pos;if(Math.pow(i.x-e.x,2)+Math.pow(i.y-e.y,2)<Math.pow(24,2))return!0}}catch(o){n.e(o)}finally{n.f()}return!1}},{key:"getNextId",value:function(){var e=Object(h.a)(this.elements);if(!e)return"el1";var t=e.id.match(/^el(\d+)$/);if(!t)throw new Error;return"el".concat(parseInt(t[1],10)+1)}},{key:"allowOpenContextMenu",value:function(){return!this.hoverElement&&!this.wireElement&&!this.panState.isPan}},{key:"getSimulation",value:function(){if(this.options.simulate)return function(e,t,n){var o=!1;function r(t){var n=t.split(":")[0],i=e.find((function(e){return e.id===n}));if(!i)throw new Error("No element");return i}var s,a=e.filter((function(e){return e.type===i.INPUT})),c=new Map,l=new Set,h=Object(m.a)(t);try{for(h.s();!(s=h.n()).done;){var p=Object(d.a)(s.value,2),f=p[0],v=p[1],O=G(f),y=G(v),b=c.get(O),g=c.get(y);if(b&&g){var j=[].concat(Object(u.a)(b),Object(u.a)(g));l.delete(b),l.delete(g),l.add(j);var E,x=Object(m.a)(j);try{for(x.s();!(E=x.n()).done;){var I=E.value;c.set(I,j)}}catch(N){x.e(N)}finally{x.f()}}else if(b)b.push(y),c.set(y,b);else if(g)g.push(O),c.set(O,g);else{var w=[O,y];l.add(w),c.set(O,w),c.set(y,w)}}}catch(N){h.e(N)}finally{h.f()}var S=Object(u.a)(l.values()).map((function(e){return{state:k.IMPEDANCE,pins:e}}));return function(e){var t,s=new Map,c=Object(m.a)(e);try{for(c.s();!(t=c.n()).done;){var l,u=t.value,d=Object(m.a)(u.pins);try{for(d.s();!(l=d.n()).done;){var h=l.value;s.set(h,u)}}catch(N){d.e(N)}finally{d.f()}}}catch(N){c.e(N)}finally{c.f()}var p=!0;function f(e,t){return t===k.POWER&&e.state===k.GROUND||t===k.GROUND&&e.state===k.POWER?(o=!0,void(e.state=k.SHORT_CIRCUIT)):void(e.state!==t&&(e.state=t,p=!0))}for(var v=0;p;){if(p=!1,(v+=1)>100)throw new Error("Simulation in infinity loop");var O,y=Object(m.a)(e);try{for(y.s();!(O=y.n()).done;){var b,g=O.value,j=Object(m.a)(g.pins);try{for(j.s();!(b=j.n()).done;){var E=r(b.value);switch(E.type){case i.INPUT:var x=a.indexOf(E);f(g,n[x]?k.POWER:k.GROUND);break;case i.POWER:f(g,k.POWER);break;case i.GROUND:f(g,k.GROUND);break;case i.NPN:var I=s.get("".concat(E.id,":0")),w=s.get("".concat(E.id,":1")),S=s.get("".concat(E.id,":2"));I&&I.state===k.GROUND&&w&&w.state===k.POWER&&S&&f(S,k.POWER);break;case i.PNP:var P=s.get("".concat(E.id,":0")),T=s.get("".concat(E.id,":1")),D=s.get("".concat(E.id,":2"));P&&P.state===k.POWER&&T&&T.state===k.GROUND&&D&&f(D,k.GROUND)}if(o)return}}catch(N){j.e(N)}finally{j.f()}}}catch(N){y.e(N)}finally{y.f()}}}(S),S}(this.elements,this.connections,this.inputSignals)}}],[{key:"createEmptyModel",value:function(t){return new e({gameId:t,pos:{x:0,y:0},elements:[],connections:[],inputSignals:[],options:U})}},{key:"getLoadedState",value:function(e){var t=localStorage.getItem(F(e));if(!t)throw new Error("No saved game");var n=JSON.parse(t),i=n.pos,o=n.elements,r=n.inputSignals,s=n.connections,a=n.options,c=Object.keys(U);return{gameId:e,pos:i,elements:o,connections:s,inputSignals:r,options:Object(x.a)(Object(I.a)(a,c),U)}}},{key:"checkSavedGame",value:function(e){var t=localStorage.getItem(F(e));return Boolean(t)}},{key:"loadGame",value:function(t){return new e(e.getLoadedState(t))}},{key:"removeGame",value:function(e){localStorage.removeItem(F(e))}},{key:"cloneGame",value:function(e,t){var n=localStorage.getItem(F(e));n&&localStorage.setItem(F(t),n)}}]),e}(),Object(g.a)(T.prototype,"deleteElementInFocus",[B],Object.getOwnPropertyDescriptor(T.prototype,"deleteElementInFocus"),T.prototype),Object(g.a)(T.prototype,"updateInputSignals",[_],Object.getOwnPropertyDescriptor(T.prototype,"updateInputSignals"),T.prototype),Object(g.a)(T.prototype,"updateOptions",[_],Object.getOwnPropertyDescriptor(T.prototype,"updateOptions"),T.prototype),Object(g.a)(T.prototype,"onMouseMove",[B],Object.getOwnPropertyDescriptor(T.prototype,"onMouseMove"),T.prototype),Object(g.a)(T.prototype,"onMouseUp",[B],Object.getOwnPropertyDescriptor(T.prototype,"onMouseUp"),T.prototype),Object(g.a)(T.prototype,"addElement",[_],Object.getOwnPropertyDescriptor(T.prototype,"addElement"),T.prototype),Object(g.a)(T.prototype,"startWiring",[B],Object.getOwnPropertyDescriptor(T.prototype,"startWiring"),T.prototype),Object(g.a)(T.prototype,"resetCursorState",[B],Object.getOwnPropertyDescriptor(T.prototype,"resetCursorState"),T.prototype),Object(g.a)(T.prototype,"clearState",[_],Object.getOwnPropertyDescriptor(T.prototype,"clearState"),T.prototype),Object(g.a)(T.prototype,"reloadFromSave",[_],Object.getOwnPropertyDescriptor(T.prototype,"reloadFromSave"),T.prototype),Object(g.a)(T.prototype,"updateElement",[B],Object.getOwnPropertyDescriptor(T.prototype,"updateElement"),T.prototype),Object(g.a)(T.prototype,"checkHover",[B],Object.getOwnPropertyDescriptor(T.prototype,"checkHover"),T.prototype),T);function Y(e,t){var n,i=W(),o=e.stateListeners.find((function(e){return e.forceUpdate===i})),r=H(t),s=e.getState();if(o)return o.isActual=!0,n=o.actualSelectedValue?o.actualSelectedValue.value:r(s),o.lastSelectedValue=n,o.isActual=!0,n;var a=r(s);return e.stateListeners.push({forceUpdate:i,selector:r,actualSelectedValue:void 0,lastSelectedValue:a,isActual:!0}),a}function z(e,t){var n=H(t);Object(s.useEffect)((function(){return window.addEventListener(e,n,!1),function(){window.removeEventListener(e,n,!1)}}),[e,n])}var X=n(44);function $(e){return Object(s.useRef)(e).current}function Q(e){var t=e.elementsCount,n=e.index,i=e.isInput,o=i?"ABCDEFGHIJ":"YZXWVUTSRQ";return!e.isVector&&t<=o.length?o.charAt(n):i?"I".concat(n):"Y".concat(n)}function Z(e,t){var n=t.gameState,r=t.size,s=t.densityFactor,a=t.assets,c=t.tick,l=n.pos,u=n.elements,h=n.connections,p=n.focusElement,f=n.hoverElement,v=n.wireElement,O=n.options,y=n.nodesSimulation;function b(e){var t=u.find((function(t){return t.id===e}));if(!t)throw new Error("Element ".concat(e," is not found"));return t}var g=new Map;if(y){var j,E=Object(m.a)(y);try{for(E.s();!(j=E.n()).done;){var x,I=j.value,w=Object(m.a)(I.pins);try{for(w.s();!(x=w.n()).done;){var S=x.value;g.set(S,I.state)}}catch(pe){w.e(pe)}finally{w.f()}}}catch(pe){E.e(pe)}finally{E.f()}}e.save(),e.clearRect(0,0,r.width*s,r.height*s),1!==s&&e.scale(s,s),e.translate(Math.floor(r.width/2)+l.x,Math.floor(r.height/2)+l.y),O.debugDrawAxis&&(e.save(),e.lineWidth=1,e.textBaseline="middle",e.textAlign="center",e.font="15px sans-serif",e.fillStyle="#333",e.beginPath(),e.moveTo(0,0),e.lineTo(100,0),e.moveTo(95,-5),e.lineTo(100,0),e.moveTo(95,5),e.lineTo(100,0),e.strokeStyle="#0f0",e.stroke(),e.fillText("X",90,15),e.beginPath(),e.moveTo(0,0),e.lineTo(0,100),e.moveTo(-5,95),e.lineTo(0,100),e.moveTo(5,95),e.lineTo(0,100),e.strokeStyle="#00f",e.stroke(),e.fillText("Y",12,90),e.restore());var N,P=Object(m.a)(u);try{for(P.s();!(N=P.n()).done;){var T=N.value,D=T.pos,U=f&&f.type===o.ELEMENT&&T.id===f.elId,R=p&&p.type===o.ELEMENT&&p.elId===T.id;(U||R)&&(e.save(),U?(e.strokeStyle=R?"#7f7fff":"#e5e5e5",e.lineWidth=3):(e.strokeStyle="#bebeff",e.lineWidth=2),e.strokeRect(D.x-26,D.y-26,52,52),e.restore())}}catch(pe){P.e(pe)}finally{P.f()}var L,W=0,A=Object(m.a)(h);try{for(A.s();!(L=A.n()).done;){var H=Object(d.a)(L.value,2),V=H[0],F=H[1],B=b(V.elId),_=b(F.elId),J=g.get(G(V)),Y=M[B.type].pins[V.pinIndex],z=M[_.type].pins[F.pinIndex];e.save(),e.beginPath(),e.moveTo(B.pos.x-24+Y.pos.x*C,B.pos.y-24+Y.pos.y*C),e.lineTo(_.pos.x-24+z.pos.x*C,_.pos.y-24+z.pos.y*C);var X=f&&f.type===o.CONNECTION&&f.connectionIndex===W,$=p&&p.type===o.CONNECTION&&p.connectionIndex===W,Z=1;X||$?Z=3:J===k.SHORT_CIRCUIT&&(Z=2);var q="#333",K=!1,ee=!1;J===k.SHORT_CIRCUIT?q="#f00":J===k.POWER?(q="#ff9038",K=!0,ee=!0):J===k.GROUND?(q="#aaaaff",K=!0,ee=!0):J===k.IMPEDANCE?(q="#c7c7c7",K=!0):X&&$?q="#8080ff":$&&(q="#bfbfff"),e.lineWidth=Z,e.strokeStyle=q,K&&!X&&(ee?e.setLineDash(c%2?[6,6]:[0,6,6,0]):e.setLineDash([4,11])),e.stroke(),e.restore(),W+=1}}catch(pe){A.e(pe)}finally{A.f()}if(v){var te=v.elId,ne=v.pinIndex,ie=b(te),oe=M[ie.type].pins[ne].pos,re=oe.x*C+ie.pos.x-24,se=oe.y*C+ie.pos.y-24;if(v.pullPos){var ae=v.pullPos,ce=ae.x,le=ae.y;e.save(),e.beginPath(),e.moveTo(re,se),e.lineTo(ce,le),e.strokeStyle="#888",e.stroke(),e.restore()}}var ue,de=Object(m.a)(u);try{var he=function(){var t=ue.value,n=t.id,r=t.type,c=t.pos;if(r===i.INPUT||r===i.OUTPUT){var l=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return Q({elementsCount:e.length,index:e.indexOf(t),isInput:t.type===i.INPUT,isVector:n})}(u.filter((function(e){return e.type===r})),t,r===i.INPUT?O.isInputVector:O.isOutputVector);e.save(),e.textAlign="center",e.textBaseline="middle",e.font="24px sans-serif",r===i.INPUT?e.fillText(l,c.x,c.y-10):e.fillText(l,c.x+6,c.y),e.restore()}else{var h,p=s>1.5?["x2","x1"]:["x1","x2"],y=Object(d.a)(p,2),b=y[0],j=y[1],E=null!==(h=a[b].images[r])&&void 0!==h?h:a[j].images[r];if(E){var x=c.x-24,I=c.y-24;e.drawImage(E,x,I,C,C)}}O.debugDrawId&&(e.textAlign="center",e.textBaseline="middle",e.font="16px sans-serif",e.fillText(n,c.x+24-6,c.y-24+6));var w,S=M[r].pins,N=0,P=Object(m.a)(S);try{for(P.s();!(w=P.n()).done;){var T,D=w.value,U=f&&f.type===o.PIN&&f.elId===t.id&&f.pinIndex===N,R=v&&v.elId===t.id&&v.pinIndex===N;e.beginPath(),e.arc(c.x+(D.pos.x-.5)*C,c.y+(D.pos.y-.5)*C,U||R?6:5,0,2*Math.PI),e.closePath();var L=g.get(G({elId:t.id,pinIndex:N})),W=void 0,A=!1;if([i.DOT,i.INPUT,i.OUTPUT,i.GROUND,i.POWER].includes(t.type))switch(L){case k.SHORT_CIRCUIT:W="#f00";break;case k.POWER:W="#ffc59b";break;case k.GROUND:W="#d4d4ff"}W||!U&&!R||(W=R?"#d66":"#66d",A=!0),e.save(),e.fillStyle=null!==(T=W)&&void 0!==T?T:"#fff",e.fill(),A||(e.strokeStyle="#448",e.lineWidth=2,e.stroke()),e.restore(),N+=1}}catch(pe){P.e(pe)}finally{P.f()}};for(de.s();!(ue=de.n()).done;)he()}catch(pe){de.e(pe)}finally{de.f()}e.restore()}function q(){var e=Object(s.useState)(!0),t=Object(d.a)(e,2),n=t[0],i=t[1];return function(e,t){var n=H(t);Object(s.useEffect)((function(){return document.addEventListener(e,n,!1),function(){document.removeEventListener(e,n,!1)}}),[e,n])}("visibilitychange",(function(){var e="visible"===document.visibilityState;n!==e&&i(e)})),n}function K(e,t){var n=q(),i=A(e);Object(s.useEffect)((function(){if(n&&i.current){var e=window.setInterval((function(){i.current&&i.current()}),t);return function(){window.clearInterval(e)}}}),[n,t,Boolean(i.current)])}var ee=n(0),te=v("h2",{margin:0});function ne(e){var t,n=Y(e.gameModel,(function(e){return{elements:e.elements,connections:e.connections}})),i=n.elements,o=n.connections,r=[],s=Object(m.a)(i);try{for(s.s();!(t=s.n()).done;){var a,c=t.value,l=M[c.type].pins.map((function(){return!1})),u=Object(m.a)(o);try{for(u.s();!(a=u.n()).done;){var d,h=a.value,p=Object(m.a)(h);try{for(p.s();!(d=p.n()).done;){var f=d.value;f.elId===c.id&&(l[f.pinIndex]=!0)}}catch(v){p.e(v)}finally{p.f()}}}catch(v){u.e(v)}finally{u.f()}l.some((function(e){return!e}))&&r.push("Floating pins on node ".concat(c.type))}}catch(v){s.e(v)}finally{s.f()}return r.length?Object(ee.jsxs)("div",{children:[Object(ee.jsx)(te,{children:"Errors:"}),r.map((function(e,t){return Object(ee.jsx)("div",{children:e},t)}))]}):null}var ie=v("div",{position:"absolute",display:"flex",alignItems:"stretch",left:52,bottom:0,padding:4}),oe=v("h2",{marginRight:8,fontVariant:"20|30"}),re=v("div",{display:"flex",gap:4,variants:{reverse:{true:{flexDirection:"row-reverse"}}}}),se=v("label",{display:"grid",gridTemplateAreas:'"A"',width:30,height:30,userSelect:"none",cursor:"pointer","> *":{gridArea:"A"}}),ae=v("input",{opacity:0}),ce=v("div",{background:"#aaa","input:checked + &":{background:"#0d0"}}),le=v("p",{textAlign:"center",fontVariant:"16|30"});function ue(e){var t=e.gameModel,n=Y(t,(function(e){return{inputSignals:e.inputSignals,options:e.options}})),i=n.inputSignals,o=n.options;return i.length?Object(ee.jsxs)(ie,{children:[Object(ee.jsx)(oe,{children:"Input signals:"}),Object(ee.jsx)(re,{reverse:o.isInputVector,children:i.map((function(e,n){return Object(ee.jsxs)(se,{children:[Object(ee.jsx)(ae,{type:"checkbox",checked:e,onChange:function(e){var o=i.map((function(t,i){return i===n?e.target.checked:t}));t.updateInputSignals(o)}}),Object(ee.jsx)(ce,{}),Object(ee.jsx)(le,{children:Q({elementsCount:i.length,index:n,isInput:!0,isVector:o.isInputVector})})]},n)}))})]}):null}var de=v("div",{position:"absolute",display:"flex",flexDirection:"column",gap:4,top:0,left:0,padding:4,borderRadius:2}),he=v("button",{width:48,height:48,flexShrink:0,border:"none",color:"#333",background:"#dadada",fontVariant:"14|20",whiteSpace:"nowrap",appearance:"none","&:disabled":{color:"#999"},"&:not(:disabled)":{cursor:"pointer"}}),pe=v("span",{height:8});function fe(e){var t=e.gameModel,n=Y(t,(function(e){return{focusElement:e.focusElement,autoSaves:e.options.autoSaves}})),o=n.focusElement,r=n.autoSaves;return Object(ee.jsxs)(de,{children:[Object(ee.jsx)("a",{href:"#",title:"",children:Object(ee.jsx)(he,{type:"button",children:"Menu"})}),Object(ee.jsx)(pe,{}),Object(ee.jsx)(he,{type:"button",onClick:function(e){e.preventDefault(),t.addElement(i.POWER)},children:"DD"}),Object(ee.jsx)(he,{type:"button",onClick:function(e){e.preventDefault(),t.addElement(i.GROUND)},children:"GND"}),Object(ee.jsx)(he,{type:"button",onClick:function(e){e.preventDefault(),t.addElement(i.NPN)},children:"npn"}),Object(ee.jsx)(he,{type:"button",onClick:function(e){e.preventDefault(),t.addElement(i.PNP)},children:"pnp"}),Object(ee.jsx)(he,{type:"button",onClick:function(e){e.preventDefault(),t.addElement(i.INPUT)},children:"input"}),Object(ee.jsx)(he,{type:"button",onClick:function(e){e.preventDefault(),t.addElement(i.OUTPUT)},children:"output"}),Object(ee.jsx)(he,{type:"button",onClick:function(e){e.preventDefault(),t.addElement(i.DOT)},children:"dot"}),Object(ee.jsx)(pe,{}),Object(ee.jsx)(he,{type:"button",disabled:!o,onClick:function(e){e.preventDefault(),t.deleteElementInFocus()},children:"delete"}),Object(ee.jsx)(pe,{}),!r&&Object(ee.jsxs)(ee.Fragment,{children:[Object(ee.jsx)(he,{type:"button",onClick:function(e){e.preventDefault(),t.reloadFromSave()},children:"Reload"}),Object(ee.jsx)(he,{type:"button",onClick:function(e){e.preventDefault(),t.saveGame()},children:"Save"})]}),Object(ee.jsx)(he,{type:"button",onClick:function(e){e.preventDefault(),t.clearState()},children:"Clear"})]})}var ve=v("label",{userSelect:"none","> input:not(:disabled)":{cursor:"pointer"}});function me(e){var t=e.title,n=e.checked,i=e.onChange;return Object(ee.jsxs)(ve,{children:[Object(ee.jsx)("input",{type:"checkbox",checked:n,onChange:function(e){i(e.target.checked)}})," ",t]})}var Oe=v("div",{display:"flex",flexDirection:"column","> *":{flexShrink:0}}),ye=v("button",{marginBottom:5,border:"1px solid #999",borderRadius:0,appearance:"none",cursor:"pointer",variants:{active:{true:{color:"#fff",background:"lightgreen"}}}});function be(e){var t=e.gameModel,n=Y(t,(function(e){return e.options}));function i(e){t.updateOptions(Object(O.a)(Object(O.a)({},n),e))}function o(e){var t=e.title,o=e.optionName;return Object(ee.jsx)(me,{title:t,checked:n[o],onChange:function(e){i(Object(D.a)({},o,e))}})}return Object(ee.jsxs)(Oe,{children:[Object(ee.jsx)(ye,{type:"button",active:n.simulate,onClick:function(e){e.preventDefault(),i({simulate:!n.simulate})},children:n.simulate?"Simulation: ON":"Simulation: OFF"}),Object(ee.jsx)(o,{title:"Auto saves",optionName:"autoSaves"}),Object(ee.jsx)(o,{title:"Debug: draw fps",optionName:"debugShowFps"}),Object(ee.jsx)(o,{title:"Debug: draw id",optionName:"debugDrawId"}),Object(ee.jsx)(o,{title:"Debug: draw axis",optionName:"debugDrawAxis"}),Object(ee.jsx)(o,{title:"Treat input as vector",optionName:"isInputVector"}),Object(ee.jsx)(o,{title:"Treat output as vector",optionName:"isOutputVector"})]})}var ge=v("span",{color:"#4ebd4e"}),je=v("span",{color:"#666"});function Ee(e){return e?Object(ee.jsx)(ge,{children:"yes"}):Object(ee.jsx)(je,{children:"no"})}function xe(e){var t=Y(e.gameModel,(function(e){return e})),n=t.elements,i=t.connections,r=t.movingElement,s=t.focusElement,a=t.hoverElement,c=t.wireElement,l=t.panState;return Object(ee.jsxs)("div",{children:[Object(ee.jsxs)("div",{children:["elements: ",n.length]}),Object(ee.jsxs)("div",{children:["connections: ",i.length]}),Object(ee.jsxs)("div",{children:["el moving: ",Ee(r)]}),Object(ee.jsxs)("div",{children:["el in focus:"," ",Ee(s&&s.type===o.ELEMENT)]}),Object(ee.jsxs)("div",{children:["conn in focus:"," ",Ee(s&&s.type===o.CONNECTION)]}),Object(ee.jsxs)("div",{children:["el hover:"," ",Ee(a&&a.type===o.ELEMENT)]}),Object(ee.jsxs)("div",{children:["pin hover: ",Ee(a&&a.type===o.PIN)]}),Object(ee.jsxs)("div",{children:["conn hover:"," ",Ee(a&&a.type===o.CONNECTION)]}),Object(ee.jsxs)("div",{children:["wiring: ",Ee(c)]}),Object(ee.jsxs)("div",{children:["drag: ",Ee(l.isPan)]})]})}var Ie=v("main",{position:"relative",display:"flex",alignItems:"stretch",flexGrow:1,width:"100%",height:"100%",overflow:"hidden"}),we=v("div",{position:"relative",flexGrow:1,overflow:"hidden"}),Se=v("canvas",{display:"block",cursor:"initial",variants:{enableScaling:{true:{transformOrigin:"0 0",transform:"scale(var(--factor, 1))"}}}}),Ne=v("span",{position:"absolute",top:6,right:6,userSelect:"none",pointerEvents:"none"}),Pe=v("span",{flexGrow:1}),ke=v("div",{display:"none","@bp2":{display:"flex",flexShrink:0,flexDirection:"column",flexBasis:300,padding:"16px 20px",borderLeft:"1px solid #888",background:"#ddd",overflow:"hidden",overflowY:"auto","> *:not(:last-child)":{marginBottom:16}}});function Te(){var e;return null!==(e=window.devicePixelRatio)&&void 0!==e?e:1}function De(e){var t=e.gameId,n=Object(s.useRef)(null),o=Object(s.useRef)(null),a=W(),c=Object(s.useState)(0),l=Object(d.a)(c,2),u=l[0],h=l[1],p=$({value:Te()}),f=Object(s.useRef)(0),v=Object(s.useMemo)((function(){return J.checkSavedGame(t)?J.loadGame(t):J.createEmptyModel(t)}),[t]),m=Y(v,(function(e){var t=e.cursor,n=e.options;return{cursor:t,showFps:n.debugShowFps,simulate:n.simulate}})),O=m.cursor,y=m.showFps,b=m.simulate,g=$({value:0});K(y?function(){h(g.value),g.value=0}:void 0,1e3);var j=$({width:0,height:0}),E=function(e){var t=e.densityFactor,n=e.draw,o=$({x1:{images:{},status:r.NONE},x2:{images:{},status:r.NONE}});return Object(s.useEffect)((function(){var e=t>1.5,s=o[e?"x1":"x2"];if(s.status===r.NONE){var a=[i.PNP,i.NPN,i.POWER,i.GROUND],c=a.length;s.status=r.LOADING;for(var l=function(){var t=d[u],n=new Image;n.src="assets/".concat(t).concat(e?"@2x":"",".png"),n.addEventListener("load",(function(){s.images[t]=n,h()})),n.addEventListener("error",h)},u=0,d=a;u<d.length;u++)l()}function h(){0===(c-=1)&&(s.status=r.DONE,n())}}),[t]),o}({densityFactor:p.value,draw:function(){return S()}});function x(e){var t=e.x,n=e.y;return{x:Math.floor(t-j.width/2),y:Math.floor(n-j.height/2)}}function I(){var e=Te();return e!==p.value&&(p.value=e,a(),!0)}var w=H((function(){if(0!==j.width&&!I()){var e=function(e){if(!e)throw new Error;var t=e.getContext("2d");if(!t)throw new Error;return t}(n.current);y&&(g.value+=1),Z(e,{gameState:v.getState(),size:j,densityFactor:p.value,assets:E,tick:f.current})}})),S=Object(s.useMemo)((function(){var e=1e3/60;return Object(X.a)(w,e,{maxWait:e,leading:!0,trailing:!0})}),[w]);function N(){var e=o.current,t=n.current;if(!e||!t)throw new Error;j.width=e.clientWidth,j.height=e.clientHeight,t.width=j.width*p.value,t.height=j.height*p.value,S()}return K(b?function(){f.current+=1,S()}:void 0,500),Object(s.useEffect)((function(){return v.setDrawHandler(S),function(){v.destroy()}}),[]),Object(s.useLayoutEffect)(N,[p.value]),z("resize",(function(){setTimeout((function(){I(),N()}),0)})),Object(ee.jsxs)(Ie,{children:[Object(ee.jsxs)(we,{ref:o,children:[Object(ee.jsx)(Se,{ref:n,enableScaling:1!==p.value,width:0,height:0,style:{"--factor":1/p.value,cursor:O},onClick:function(e){0===e.button&&e.preventDefault()},onMouseDown:function(e){0===e.button&&(e.preventDefault(),v.onMouseDown())},onMouseMove:function(e){v.onMouseMove({position:x({x:e.clientX,y:e.clientY}),movement:{x:e.movementX,y:e.movementY}})},onMouseUp:function(e){0===e.button&&(e.preventDefault(),v.onMouseUp())},onMouseLeave:function(){v.resetCursorState()},onContextMenu:function(e){v.allowOpenContextMenu()||e.preventDefault()}}),y&&Object(ee.jsx)(Ne,{children:u})]}),Object(ee.jsx)(fe,{gameModel:v}),Object(ee.jsx)(ue,{gameModel:v}),Object(ee.jsxs)(ke,{children:[Object(ee.jsx)(be,{gameModel:v}),Object(ee.jsx)(ne,{gameModel:v}),Object(ee.jsx)(Pe,{}),Object(ee.jsx)(xe,{gameModel:v})]})]})}var Ce=v("div",{padding:16}),Me=v("h1",{margin:0}),Ue=v("h2",{fontVariant:"18|24"}),Re=v("ul",{marginBottom:10}),Le=v("li",{display:"flex",alignItems:"center",padding:"2px 0"}),Ge=v("p",{minWidth:140,marginRight:16}),We=v("a",{}),Ae=v("button",{"+ button":{marginLeft:5}});function He(e){var t=e.match(/^[gs](\d+)$/);if(t)return{gameId:t[0],gameNumber:parseInt(t[1],10)}}function Ve(e){var t,n=(null!==(t=window.location.hash)&&void 0!==t?t:"").trim().replace(/^#/,"");if(n){var i=He(n);if(i&&e.some((function(e){return e.id===i.gameId})))return i.gameId}}function Fe(e){var t=Object(h.a)(e);if(!t)return"s1";var n=He(t.id);if(!n)throw new Error;return"s".concat(n.gameNumber+1)}function Be(){var e=Object(s.useMemo)((function(){var e=localStorage.getItem("sch_games");return e?JSON.parse(e).map((function(e){return"string"===typeof e?{id:e,title:e}:e})):[]}),[]),t=Object(s.useState)(e),n=Object(d.a)(t,2),i=n[0],o=n[1];!function(e,t){var n=Object(s.useRef)(!1);Object(s.useEffect)((function(){n.current?e():n.current=!0}),t)}((function(){localStorage.setItem("sch_games",JSON.stringify(i))}),[i]);var r=Object(s.useState)(Ve(i)),a=Object(d.a)(r,2),c=a[0],l=a[1];return z("hashchange",(function(){var e=Ve(i);e!==c&&l(e)})),c?Object(ee.jsx)(De,{gameId:c},c):Object(ee.jsxs)(Ce,{children:[Object(ee.jsx)(Me,{children:"Schematic"}),Object(ee.jsx)(Ue,{children:"Current schemas:"}),Object(ee.jsx)(Re,{children:i.length?i.map((function(e,t){var n=e.id,r=e.title;return Object(ee.jsxs)(Le,{children:[Object(ee.jsx)(Ge,{children:Object(ee.jsx)(We,{href:"#".concat(n),children:r})}),Object(ee.jsx)(Ae,{type:"button",onClick:function(e){e.preventDefault();var r=window.prompt("Enter clone game name");if(r&&r.trim()){var s={id:Fe(i),title:r};J.cloneGame(n,s.id),o(function(e,t,n){return[].concat(Object(u.a)(e.slice(0,n)),[t],Object(u.a)(e.slice(n)))}(i,s,t))}},children:"clone"}),Object(ee.jsx)(Ae,{type:"button",onClick:function(e){e.preventDefault(),window.confirm("Are you sure?")&&(o(i.filter((function(e){return e.id!==n}))),J.removeGame(n))},children:"x"})]},n)})):Object(ee.jsx)("div",{children:"no saved schemas"})}),Object(ee.jsx)("button",{type:"button",onClick:function(e){e.preventDefault();var t=Fe(i),n=window.prompt("Enter new game name");n&&n.trim()&&(o([].concat(Object(u.a)(i),[{id:t,title:n.trim()}])),window.setTimeout((function(){window.location.assign("#".concat(t))}),0))},children:"New schema"})]})}l.a.render(Object(ee.jsx)(a.a.StrictMode,{children:Object(ee.jsx)(Be,{})}),document.getElementById("root"))}},[[54,1,2]]]);
//# sourceMappingURL=main.a2d74cb2.chunk.js.map