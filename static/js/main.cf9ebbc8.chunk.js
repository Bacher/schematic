(this.webpackJsonpschematic=this.webpackJsonpschematic||[]).push([[0],{10:function(e,t,n){e.exports={wrapper:"App_wrapper__1Jn2B",title:"App_title__2C-7r",gamesTitle:"App_gamesTitle__zqWFJ",removeButton:"App_removeButton__1M5gF"}},15:function(e,t,n){e.exports={title:"SchemaErrors_title__DGpx-"}},2:function(e,t,n){e.exports={app:"Emulator_app__T00XQ",panel:"Emulator_panel__NbdHB",button:"Emulator_button__3x9P5",canvasWrapper:"Emulator_canvasWrapper__1jUgz",canvas:"Emulator_canvas__18vZ6",canvasScale:"Emulator_canvasScale__1gfv0",info:"Emulator_info__XN-lN",divider:"Emulator_divider__1O1xo",space:"Emulator_space__3sZL6",yes:"Emulator_yes__2HVG8",no:"Emulator_no__3K5j9"}},20:function(e,t,n){},22:function(e,t,n){"use strict";n.r(t);var r=n(1),a=n.n(r),o=n(13),c=n.n(o),i=(n(20),n(9)),s=n(5);function l(e,t){var n=Object(r.useRef)(!1);Object(r.useEffect)((function(){n.current?e():n.current=!0}),t)}function u(e){var t=function(e){var t=Object(r.useRef)(e);return t.current=e,t}(e);return Object(r.useCallback)((function(){return t.current.apply(t,arguments)}),[])}function d(e,t){var n=u(t);Object(r.useEffect)((function(){return window.addEventListener(e,n,!1),function(){window.removeEventListener(e,n,!1)}}),[e,n])}var p,f,v=n(12),h=n(4),j=n(3),b=n(14),O=n.n(b);function x(e){return Object(r.useRef)(e).current}!function(e){e.PNP="pnp",e.NPN="npn",e.POWER="power",e.GROUND="ground",e.INPUT="input",e.OUTPUT="output",e.DOT="dot"}(p||(p={}));var m=(f={},Object(h.a)(f,p.PNP,{pins:[{pos:{x:.47,y:.94}},{pos:{x:-.07,y:.32}},{pos:{x:1.05,y:.32}}]}),Object(h.a)(f,p.NPN,{pins:[{pos:{x:.47,y:1}},{pos:{x:-.07,y:.33}},{pos:{x:1.05,y:.32}}]}),Object(h.a)(f,p.POWER,{pins:[{pos:{x:.52,y:.8}}]}),Object(h.a)(f,p.GROUND,{pins:[{pos:{x:.46,y:.15}}]}),Object(h.a)(f,p.INPUT,{pins:[{pos:{x:.5,y:.8}}]}),Object(h.a)(f,p.OUTPUT,{pins:[{pos:{x:.2,y:.5}}]}),Object(h.a)(f,p.DOT,{pins:[{pos:{x:.5,y:.5}}]}),f),g="ABCDEFGHIJ",y="YZXWVUTSRQ";function I(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=e.indexOf(t),a=t.type===p.INPUT?g:y;return!n&&e.length<=a.length?a.charAt(r):t.type===p.INPUT?"I".concat(r):"Y".concat(r)}var N=n(6),w=n.n(N),_=n(0);function D(e){var t=e.elements,n=e.options,a=e.onOptionsChange,o=Object(r.useMemo)((function(){var e=t.filter((function(e){return e.type===p.INPUT})),r=t.filter((function(e){return e.type===p.OUTPUT})),a=e,o=r;return n.isInputVector&&(a=Object(i.a)(e).reverse()),n.isOutputVector&&(o=Object(i.a)(r).reverse()),{inputs:e,outputs:r,renderInputs:a,renderOutputs:o}}),[t,t.length,n.isInputVector,n.isOutputVector]),c=o.inputs,s=o.outputs,l=o.renderInputs,u=o.renderOutputs;return Object(_.jsxs)("div",{className:w.a.wrapper,children:[Object(_.jsxs)("div",{className:w.a.options,children:[Object(_.jsxs)("label",{className:w.a.option,children:[Object(_.jsx)("input",{type:"checkbox",checked:n.isInputVector,onChange:function(e){a({isInputVector:e.target.checked})}})," ","Treat input as vector"]}),Object(_.jsxs)("label",{className:w.a.option,children:[Object(_.jsx)("input",{type:"checkbox",checked:n.isOutputVector,onChange:function(e){a({isOutputVector:e.target.checked})}})," ","Treat output as vector"]})]}),Object(_.jsxs)("table",{className:w.a.table,children:[Object(_.jsx)("thead",{children:Object(_.jsxs)("tr",{children:[l.map((function(e,t){return Object(_.jsx)("th",{className:w.a.tableCell,children:I(c,e,n.isInputVector)},t)})),u.map((function(e,t){return Object(_.jsx)("th",{className:w.a.tableCell,children:I(s,e,n.isOutputVector)},t)}))]})}),Object(_.jsx)("tbody",{children:Array.from({length:Math.pow(2,c.length)}).map((function(e,t){return Object(_.jsxs)("tr",{children:[l.map((function(e,n){return Object(_.jsx)("td",{children:Math.floor(t/Math.pow(2,c.length-n-1))%2},n)})),u.map((function(e,t){return Object(_.jsx)("td",{children:"Z"},t)}))]},t)}))})]})]})}var P=n(15),T=n.n(P);function E(e){var t,n=e.state,r=[],a=Object(j.a)(n.elements);try{for(a.s();!(t=a.n()).done;){var o,c=t.value,i=m[c.type].pins.map((function(){return!1})),s=Object(j.a)(n.connections);try{for(s.s();!(o=s.n()).done;){var l,u=o.value,d=Object(j.a)(u);try{for(d.s();!(l=d.n()).done;){var p=l.value;p.elId===c.id&&(i[p.pinIndex]=!0)}}catch(f){d.e(f)}finally{d.f()}}}catch(f){s.e(f)}finally{s.f()}i.some((function(e){return!e}))&&r.push("Floating pins on node ".concat(c.type))}}catch(f){a.e(f)}finally{a.f()}return r.length?Object(_.jsxs)("div",{children:[Object(_.jsx)("h2",{className:T.a.title,children:"Errors:"}),r.map((function(e,t){return Object(_.jsx)("div",{children:e},t)}))]}):null}var k,S=n(2),M=n.n(S),C=48,U=52;function R(e){var t=e.elements[e.elements.length-1];if(!t)return"el1";var n=t.id.match(/^el(\d+)$/);if(!n)throw new Error;return"el".concat(parseInt(n[1],10)+1)}function V(e){return e?Object(_.jsx)("span",{className:M.a.yes,children:"yes"}):Object(_.jsx)("span",{className:M.a.no,children:"no"})}function W(e){var t,n,a,o=e.gameId,c=Object(r.useRef)(null),i=Object(r.useRef)(null),f=function(){var e=Object(r.useRef)(0),t=Object(r.useState)(e.current),n=Object(s.a)(t,2)[1];return Object(r.useCallback)((function(){e.current+=1,n(e.current)}),[])}(),b=Object(r.useState)(),g=Object(s.a)(b,2),y=g[0],N=g[1],w=Object(r.useState)({isInputVector:!1,isOutputVector:!1}),P=Object(s.a)(w,2),T=P[0],S=P[1],W=x({factor:null!==(t=window.devicePixelRatio)&&void 0!==t?t:1}),A=x({width:0,height:0}),G=x({x:0,y:0}),L=x({x1:{images:{},status:k.NONE},x2:{images:{},status:k.NONE}}),B=x({x:0,y:0}),J=x({target:void 0}),H=x({elId:void 0}),X=x({target:void 0}),Y=x({source:void 0}),Z=x({elements:[],connections:[]}),z=x({isMouseDown:!1,isDrag:!1});function F(e){var t=e.x,n=e.y;return{x:t-A.width/2-G.x,y:n-A.height/2-G.y}}function $(){G.x=0,G.y=0,Z.elements=[],Z.connections=[],J.target=void 0,H.elId=void 0,X.target=void 0,Y.source=void 0,z.isDrag=!1,z.isMouseDown=!1}var q=u((function(){var e=localStorage.getItem("sch_game_".concat(o));if(e){var t=JSON.parse(e),n=t.pos,r=t.elements,c=t.connections,i=t.options;$(),G.x=n.x,G.y=n.y,Z.elements=r,Z.connections=c,S(i),window.setTimeout(a,0)}}));Object(r.useEffect)((function(){q();var e=window.setInterval(f,500);return function(){window.clearInterval(e)}}),[]);var Q=u((function(e){var t=Z.elements.find((function(t){return t.id===e}));if(!t)throw new Error("Element not found");return t}));function K(){var e,t=null!==(e=window.devicePixelRatio)&&void 0!==e?e:1;W.factor!==t&&(W.factor=t,f())}function ee(){var e=i.current,t=c.current;if(!e||!t)throw new Error;A.width===e.clientWidth&&A.height===e.clientHeight||(A.width=e.clientWidth,A.height=e.clientHeight,a())}function te(e){var t,n=Object(j.a)(Z.elements);try{for(n.s();!(t=n.n()).done;){var r=t.value.pos;if(Math.pow(r.x-e.x,2)+Math.pow(r.y-e.y,2)<Math.pow(24,2))return!0}}catch(a){n.e(a)}finally{n.f()}return!1}function ne(e){for(var t=F({x:A.width/2,y:A.height/2});te(t);)t.x+=68;Z.elements.push({type:e,id:R(Z),pos:t}),a()}function re(){var e=W.factor>1.5,t=L[e?"x1":"x2"];if(t.status===k.NONE){var n=[p.PNP,p.NPN,p.POWER,p.GROUND],r=n.length;t.status=k.LOADING;for(var o=function(){var n=i[c],r=new Image;r.src="assets/".concat(n).concat(e?"@2x":"",".png"),r.addEventListener("load",(function(){t.images[n]=r,s()})),r.addEventListener("error",s)},c=0,i=n;c<i.length;c++)o()}function s(){0===(r-=1)&&(t.status=k.DONE,a())}}function ae(e){var t=e.elId,n=e.pinIndex;H.elId=t,Y.source={elId:t,pinIndex:n}}a=u((function(){var e,t=function(e){if(!e)throw new Error;var t=e.getContext("2d");if(!t)throw new Error;return t}(c.current);K();var n=W.factor;t.save(),t.clearRect(0,0,A.width*n,A.height*n),1===n?t.translate(.5,.5):t.scale(n,n),t.translate(A.width/2+G.x,A.height/2+G.y);var r,a=Object(j.a)(Z.elements);try{for(a.s();!(r=a.n()).done;){var o,i=r.value,l=i.pos;i.id===(null===(o=J.target)||void 0===o?void 0:o.elId)?(t.save(),t.strokeStyle="#ddf",t.lineWidth=3,t.strokeRect(l.x-26,l.y-26,U,U),t.restore()):i.id===H.elId&&(t.save(),t.strokeStyle="#ededf3",t.lineWidth=2,t.strokeRect(l.x-26,l.y-26,U,U),t.restore())}}catch(te){a.e(te)}finally{a.f()}var u,d=Object(j.a)(Z.connections);try{for(d.s();!(u=d.n()).done;){var f=Object(s.a)(u.value,2),v=f[0],h=f[1],b=Q(v.elId),O=Q(h.elId),x=m[b.type].pins[v.pinIndex],g=m[O.type].pins[h.pinIndex];t.save(),t.beginPath(),t.moveTo(b.pos.x-24+x.pos.x*C,b.pos.y-24+x.pos.y*C),t.lineTo(O.pos.x-24+g.pos.x*C,O.pos.y-24+g.pos.y*C),t.strokeStyle="#333",t.stroke(),t.restore()}}catch(te){d.e(te)}finally{d.f()}if(Y.source){var w=Y.source,_=w.elId,D=w.pinIndex,P=Q(_),E=m[P.type].pins[D].pos,k=E.x*C+P.pos.x-24,S=E.y*C+P.pos.y-24,M=F(B),R=M.x,V=M.y;t.save(),t.beginPath(),t.moveTo(k,S),t.lineTo(R,V),t.strokeStyle="#888",t.stroke(),t.restore()}var X,$,q=Object(j.a)(Z.elements);try{var ee=function(){var e=X.value,r=e.type,a=e.pos;if(r===p.INPUT||r===p.OUTPUT){var o=I(Z.elements.filter((function(e){return e.type===r})),e,r===p.INPUT?T.isInputVector:T.isOutputVector);t.save(),t.textAlign="center",t.textBaseline="middle",t.font="24px sans-serif",r===p.INPUT?t.fillText(o,a.x,a.y-10):t.fillText(o,a.x+6,a.y),t.restore()}else{var c,i=n>1.5?["x2","x1"]:["x1","x2"],l=Object(s.a)(i,2),u=l[0],d=l[1],f=null!==(c=L[u].images[r])&&void 0!==c?c:L[d].images[r];if(f){var v=a.x-24,h=a.y-24;t.drawImage(f,v,h,C,C)}}var b,O=m[r].pins,x=J.target,g=0,y=Object(j.a)(O);try{for(y.s();!(b=y.n()).done;){var N=b.value,w=x&&e.id===x.elId&&x.activePin&&x.activePin.index===g,_=Y.source&&Y.source.elId===e.id&&Y.source.pinIndex===g;t.beginPath(),t.arc(a.x+(N.pos.x-.5)*C,a.y+(N.pos.y-.5)*C,w?6:5,0,2*Math.PI),t.closePath(),w||_?(t.save(),t.fillStyle=_?"#d66":"#66d",t.fill(),t.restore()):(t.save(),t.fillStyle="#fff",t.fill(),t.strokeStyle="#448",t.lineWidth=2,t.stroke(),t.restore()),g+=1}}catch(te){y.e(te)}finally{y.f()}};for(q.s();!(X=q.n()).done;)ee()}catch(te){q.e(te)}finally{q.f()}t.restore(),Y.source||(null===(e=J.target)||void 0===e?void 0:e.activePin)?$="pointer":J.target?$="move":z.isDrag&&($="grabbing"),$!==y&&N($)})),Object(r.useEffect)((function(){ee(),re()}),[]),l(re,[W.factor]),d("resize",(function(){setTimeout((function(){K(),ee()}),0)})),l(a,[T]);var oe=u((function(e){if(!e||(e.preventDefault(),0===e.button)){var t=!1;if(z.isMouseDown=!1,!H.elId||Y.source||X.target||(H.elId=void 0,t=!0),X.target&&(X.target=void 0,t=!0),z.isDrag&&(z.isDrag=!1,t=!0),Y.source){var n=J.target;n&&n.activePin&&Y.source.elId!==n.elId&&Z.connections.push([{elId:n.elId,pinIndex:n.activePin.index},{elId:Y.source.elId,pinIndex:Y.source.pinIndex}]),Y.source=void 0,t=!0}else if(!Y.source){var r=J.target;r&&r.activePin&&(ae({elId:r.elId,pinIndex:r.activePin.index}),t=!0),r&&!r.activePin&&H.elId!==r.elId&&(H.elId=r.elId,t=!0)}t&&a()}}));return Object(_.jsxs)("main",{className:M.a.app,children:[Object(_.jsx)("div",{ref:i,className:M.a.canvasWrapper,children:Object(_.jsx)("canvas",{ref:c,className:O()(M.a.canvas,Object(h.a)({},M.a.canvasScale,1!==W.factor)),width:A.width*W.factor,height:A.height*W.factor,style:{"--factor":1/W.factor,cursor:y},onClick:function(e){e.preventDefault()},onMouseDown:function(e){e.preventDefault(),0===e.button&&(z.isMouseDown&&oe(),z.isMouseDown=!0)},onMouseMove:function(e){B.x=e.clientX,B.y=e.clientY;var t=!1;(function(){var e,t=F(B),n=t.x,r=t.y,a=J.target,o=Object(j.a)(Z.elements);try{for(o.s();!(e=o.n()).done;){var c,i=e.value,s=m[i.type].pins,l=i.pos.x-24,u=i.pos.y-24,d=Object(j.a)(s);try{for(d.s();!(c=d.n()).done;){var p=c.value;if(Math.pow(l+p.pos.x*C-n,2)+Math.pow(u+p.pos.y*C-r,2)<Math.pow(9,2)){var f,v=s.indexOf(p),h=J.target;return(!h||h.elId!==i.id||(null===(f=h.activePin)||void 0===f?void 0:f.index)!==v)&&(J.target={elId:i.id,activePin:{index:v}},!0)}}}catch(I){d.e(I)}finally{d.f()}}}catch(I){o.e(I)}finally{o.f()}var b,O=Object(j.a)(Z.elements);try{for(O.s();!(b=O.n()).done;){var x=b.value,g=x.pos.x-24,y=x.pos.y-24;if(n>g&&n<g+C&&r>y&&r<y+C)return!(a&&a.elId===x.id&&!a.activePin)&&(J.target={elId:x.id,activePin:void 0},!0)}}catch(I){O.e(I)}finally{O.f()}return!!J.target&&(J.target=void 0,!0)})()&&(t=!0);var n=Boolean(X.target),r=J.target;if(z.isMouseDown){if(!n&&!Y.source&&r&&r.activePin&&(ae({elId:r.elId,pinIndex:r.activePin.index}),t=!0),!n&&Y.source&&(t=!0),n||Y.source||!r||(X.target={elId:r.elId},H.elId=r.elId,t=!0),Y.source||X.target||z.isDrag||(z.isDrag=!0,t=!0),X.target){var o=Q(X.target.elId);o.pos.x+=e.movementX,o.pos.y+=e.movementY}else Y.source||(G.x+=e.movementX,G.y+=e.movementY);t=!0}else z.isDrag&&(z.isDrag=!1,t=!0);Y.source&&(t=!0),t&&a()},onMouseUp:oe,onMouseLeave:function(){(function(){var e=!1;return z.isMouseDown&&(z.isMouseDown=!1),X.target&&(X.target=void 0,e=!0),z.isDrag&&(z.isDrag=!1,e=!0),Y.source&&(Y.source=void 0,e=!0),e})()&&a()},onContextMenu:function(e){(J.target||Y.source||z.isDrag)&&e.preventDefault()}})}),Object(_.jsxs)("div",{className:M.a.panel,children:[Object(_.jsx)("button",{type:"button",className:M.a.button,onClick:function(e){e.preventDefault(),ne(p.POWER)},children:"DD"}),Object(_.jsx)("button",{type:"button",className:M.a.button,onClick:function(e){e.preventDefault(),ne(p.GROUND)},children:"GND"}),Object(_.jsx)("button",{type:"button",className:M.a.button,onClick:function(e){e.preventDefault(),ne(p.NPN)},children:"npn"}),Object(_.jsx)("button",{type:"button",className:M.a.button,onClick:function(e){e.preventDefault(),ne(p.PNP)},children:"pnp"}),Object(_.jsx)("button",{type:"button",className:M.a.button,onClick:function(e){e.preventDefault(),ne(p.INPUT)},children:"input"}),Object(_.jsx)("button",{type:"button",className:M.a.button,onClick:function(e){e.preventDefault(),ne(p.OUTPUT)},children:"output"}),Object(_.jsx)("button",{type:"button",className:M.a.button,onClick:function(e){e.preventDefault(),ne(p.DOT)},children:"dot"}),Object(_.jsx)("span",{className:M.a.divider}),Object(_.jsx)("button",{type:"button",className:M.a.button,onClick:function(e){e.preventDefault(),q()},children:"Load"}),Object(_.jsx)("button",{type:"button",className:M.a.button,onClick:function(e){e.preventDefault(),localStorage.setItem("sch_game_".concat(o),JSON.stringify({pos:G,elements:Z.elements,connections:Z.connections,options:T})),console.info("Saved")},children:"Save"}),Object(_.jsx)("button",{type:"button",className:M.a.button,onClick:function(e){e.preventDefault(),$(),a()},children:"Clear"}),Object(_.jsx)("a",{href:"#",children:Object(_.jsx)("button",{type:"button",className:M.a.button,children:"Exit"})})]}),Object(_.jsxs)("div",{className:M.a.info,children:[Object(_.jsx)(D,{elements:Z.elements,options:T,onOptionsChange:function(e){return S(Object(v.a)(Object(v.a)({},T),e))}}),Object(_.jsx)(E,{state:Z}),Object(_.jsx)("span",{className:M.a.space}),Object(_.jsxs)("div",{className:M.a.debugPanel,children:[Object(_.jsxs)("div",{children:["elements: ",Z.elements.length]}),Object(_.jsxs)("div",{children:["connections: ",Z.connections.length]}),Object(_.jsxs)("div",{children:["el moving: ",V(X.target)]}),Object(_.jsxs)("div",{children:["el in focus: ",V(H.elId)]}),Object(_.jsxs)("div",{children:["el hover: ",V(J.target)]}),Object(_.jsxs)("div",{children:["pin hover: ",V(null===(n=J.target)||void 0===n?void 0:n.activePin)]}),Object(_.jsxs)("div",{children:["wiring: ",V(Y.source)]}),Object(_.jsxs)("div",{children:["drag: ",V(z.isDrag)]}),Object(_.jsxs)("div",{children:["mouse down: ",V(z.isMouseDown)]})]})]})]})}!function(e){e[e.NONE=0]="NONE",e[e.LOADING=1]="LOADING",e[e.DONE=2]="DONE"}(k||(k={}));var A=n(10),G=n.n(A);function L(e){var t,n=(null!==(t=window.location.hash)&&void 0!==t?t:"").trim().replace(/^#/,"");if(n){var r=n.match(/^g(\d+)$/);if(r){var a=r[0];if(e.includes(a))return a}}}function B(){var e=Object(r.useMemo)((function(){var e=localStorage.getItem("sch_games");return e?JSON.parse(e):[]}),[]),t=Object(r.useState)(e),n=Object(s.a)(t,2),a=n[0],o=n[1];l((function(){localStorage.setItem("sch_games",JSON.stringify(a))}),[a]);var c=Object(r.useState)(L(a)),u=Object(s.a)(c,2),p=u[0],f=u[1];return d("hashchange",(function(){var e=L(a);e!==p&&f(e)})),p?Object(_.jsx)(W,{gameId:p},p):Object(_.jsxs)("div",{className:G.a.wrapper,children:[Object(_.jsx)("h1",{className:G.a.title,children:"Schematic"}),Object(_.jsx)("h2",{className:G.a.gamesTitle,children:"Current schemas:"}),Object(_.jsx)("ul",{children:a.length?a.map((function(e){return Object(_.jsxs)("li",{children:[Object(_.jsx)("a",{href:"#".concat(e),children:e})," ",Object(_.jsx)("button",{type:"button",className:G.a.removeButton,onClick:function(t){t.preventDefault(),window.confirm("Are you sure?")&&(o(a.filter((function(t){return t!==e}))),localStorage.removeItem("sch_game_".concat(e)))},children:"x"})]},e)})):Object(_.jsx)("div",{children:"no saved schemas"})}),Object(_.jsx)("button",{type:"button",onClick:function(e){e.preventDefault();var t=function(e){var t=e[e.length-1];if(!t)return"g1";var n=t.match(/^g(\d+)$/);if(!n)throw new Error;return"g".concat(parseInt(n[1],10)+1)}(a);o([].concat(Object(i.a)(a),[t])),window.setTimeout((function(){window.location.assign("#".concat(t))}),0)},children:"New schema"})]})}c.a.render(Object(_.jsx)(a.a.StrictMode,{children:Object(_.jsx)(B,{})}),document.getElementById("root"))},6:function(e,t,n){e.exports={wrapper:"TruthTable_wrapper__23wrn",options:"TruthTable_options__kzZt2",option:"TruthTable_option__1Hqnt"}}},[[22,1,2]]]);
//# sourceMappingURL=main.cf9ebbc8.chunk.js.map