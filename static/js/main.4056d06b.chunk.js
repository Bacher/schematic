(this.webpackJsonpschematic=this.webpackJsonpschematic||[]).push([[0],{10:function(e,t,n){e.exports={wrapper:"App_wrapper__1Jn2B",title:"App_title__2C-7r",gamesTitle:"App_gamesTitle__zqWFJ",removeButton:"App_removeButton__1M5gF"}},14:function(e,t,n){e.exports={title:"SchemaErrors_title__DGpx-"}},19:function(e,t,n){},2:function(e,t,n){e.exports={app:"Emulator_app__T00XQ",panel:"Emulator_panel__NbdHB",button:"Emulator_button__3x9P5",canvasWrapper:"Emulator_canvasWrapper__1jUgz",canvas:"Emulator_canvas__18vZ6",info:"Emulator_info__XN-lN",divider:"Emulator_divider__1O1xo",space:"Emulator_space__3sZL6",yes:"Emulator_yes__2HVG8",no:"Emulator_no__3K5j9"}},21:function(e,t,n){"use strict";n.r(t);var r=n(1),o=n.n(r),c=n(13),a=n.n(c),i=(n(19),n(9)),s=n(5);function l(e,t){var n=Object(r.useRef)(!1);Object(r.useEffect)((function(){n.current?e():n.current=!0}),t)}function u(e){var t=function(e){var t=Object(r.useRef)(e);return t.current=e,t}(e);return Object(r.useCallback)((function(){return t.current.apply(t,arguments)}),[])}var d,p=n(12),v=n(3);function f(e){return Object(r.useRef)(e).current}!function(e){e.PNP="pnp",e.NPN="npn",e.POWER="power",e.GROUND="ground",e.INPUT="input",e.OUTPUT="output",e.DOT="dot"}(d||(d={}));var h,j=n(4),b=(h={},Object(j.a)(h,d.PNP,{pins:[{pos:{x:.47,y:.94}},{pos:{x:-.07,y:.32}},{pos:{x:1.05,y:.32}}]}),Object(j.a)(h,d.NPN,{pins:[{pos:{x:.47,y:1}},{pos:{x:-.07,y:.33}},{pos:{x:1.05,y:.32}}]}),Object(j.a)(h,d.POWER,{pins:[{pos:{x:.52,y:.8}}]}),Object(j.a)(h,d.GROUND,{pins:[{pos:{x:.46,y:.15}}]}),Object(j.a)(h,d.INPUT,{pins:[{pos:{x:.5,y:.8}}]}),Object(j.a)(h,d.OUTPUT,{pins:[{pos:{x:.2,y:.5}}]}),Object(j.a)(h,d.DOT,{pins:[{pos:{x:.5,y:.5}}]}),h),x="ABCDEFGHIJ",O="YZXWVUTSRQ";function m(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=e.indexOf(t),o=t.type===d.INPUT?x:O;return!n&&e.length<=o.length?o.charAt(r):t.type===d.INPUT?"I".concat(r):"Y".concat(r)}var g=n(6),y=n.n(g),I=n(0);function w(e){var t=e.elements,n=e.options,o=e.onOptionsChange,c=Object(r.useMemo)((function(){var e=t.filter((function(e){return e.type===d.INPUT})),r=t.filter((function(e){return e.type===d.OUTPUT})),o=e,c=r;return n.isInputVector&&(o=Object(i.a)(e).reverse()),n.isOutputVector&&(c=Object(i.a)(r).reverse()),{inputs:e,outputs:r,renderInputs:o,renderOutputs:c}}),[t,t.length,n.isInputVector,n.isOutputVector]),a=c.inputs,s=c.outputs,l=c.renderInputs,u=c.renderOutputs;return Object(I.jsxs)("div",{className:y.a.wrapper,children:[Object(I.jsxs)("div",{className:y.a.options,children:[Object(I.jsxs)("label",{className:y.a.option,children:[Object(I.jsx)("input",{type:"checkbox",checked:n.isInputVector,onChange:function(e){o({isInputVector:e.target.checked})}})," ","Treat input as vector"]}),Object(I.jsxs)("label",{className:y.a.option,children:[Object(I.jsx)("input",{type:"checkbox",checked:n.isOutputVector,onChange:function(e){o({isOutputVector:e.target.checked})}})," ","Treat output as vector"]})]}),Object(I.jsxs)("table",{className:y.a.table,children:[Object(I.jsx)("thead",{children:Object(I.jsxs)("tr",{children:[l.map((function(e,t){return Object(I.jsx)("th",{className:y.a.tableCell,children:m(a,e,n.isInputVector)},t)})),u.map((function(e,t){return Object(I.jsx)("th",{className:y.a.tableCell,children:m(s,e,n.isOutputVector)},t)}))]})}),Object(I.jsx)("tbody",{children:Array.from({length:Math.pow(2,a.length)}).map((function(e,t){return Object(I.jsxs)("tr",{children:[l.map((function(e,n){return Object(I.jsx)("td",{children:Math.floor(t/Math.pow(2,a.length-n-1))%2},n)})),u.map((function(e,t){return Object(I.jsx)("td",{children:"Z"},t)}))]},t)}))})]})]})}var N=n(14),_=n.n(N);function P(e){var t,n=e.state,r=[],o=Object(v.a)(n.elements);try{for(o.s();!(t=o.n()).done;){var c,a=t.value,i=b[a.type].pins.map((function(){return!1})),s=Object(v.a)(n.connections);try{for(s.s();!(c=s.n()).done;){var l,u=c.value,d=Object(v.a)(u);try{for(d.s();!(l=d.n()).done;){var p=l.value;p.elId===a.id&&(i[p.pinIndex]=!0)}}catch(f){d.e(f)}finally{d.f()}}}catch(f){s.e(f)}finally{s.f()}i.some((function(e){return!e}))&&r.push("Floating pins on node ".concat(a.type))}}catch(f){o.e(f)}finally{o.f()}return r.length?Object(I.jsxs)("div",{children:[Object(I.jsx)("h2",{className:_.a.title,children:"Errors:"}),r.map((function(e,t){return Object(I.jsx)("div",{children:e},t)}))]}):null}var D=n(2),T=n.n(D),k=48,E=52;function M(e){var t=e.elements[e.elements.length-1];if(!t)return"el1";var n=t.id.match(/^el(\d+)$/);if(!n)throw new Error;return"el".concat(parseInt(n[1],10)+1)}function C(e){return e?Object(I.jsx)("span",{className:T.a.yes,children:"yes"}):Object(I.jsx)("span",{className:T.a.no,children:"no"})}function S(e){var t,n,o=e.gameId,c=Object(r.useRef)(null),a=Object(r.useRef)(null),i=function(){var e=Object(r.useRef)(0),t=Object(r.useState)(e.current),n=Object(s.a)(t,2)[1];return Object(r.useCallback)((function(){e.current+=1,n(e.current)}),[])}(),h=Object(r.useState)(),j=Object(s.a)(h,2),x=j[0],O=j[1],g=Object(r.useState)({isInputVector:!1,isOutputVector:!1}),y=Object(s.a)(g,2),N=y[0],_=y[1],D=f({width:0,height:0}),S=f({x:0,y:0}),U=f({}),R=f({x:0,y:0}),V=f({target:void 0}),W=f({elId:void 0}),A=f({target:void 0}),B=f({source:void 0}),J=f({elements:[],connections:[]}),G=f({isMouseDown:!1,isDrag:!1});function L(e){var t=e.x,n=e.y;return{x:t-D.width/2-S.x,y:n-D.height/2-S.y}}function X(){S.x=0,S.y=0,J.elements=[],J.connections=[],V.target=void 0,W.elId=void 0,A.target=void 0,B.source=void 0,G.isDrag=!1,G.isMouseDown=!1}var H=u((function(){var e=localStorage.getItem("sch_game_".concat(o));if(e){var t=JSON.parse(e),r=t.pos,c=t.elements,a=t.connections,i=t.options;X(),S.x=r.x,S.y=r.y,J.elements=c,J.connections=a,_(i),window.setTimeout(n,0)}}));Object(r.useEffect)((function(){H();var e=window.setInterval(i,500);return function(){window.clearInterval(e)}}),[]);var Y=u((function(e){var t=J.elements.find((function(t){return t.id===e}));if(!t)throw new Error("Element not found");return t}));function Z(){setTimeout((function(){var e=a.current,t=c.current;if(!e||!t)throw new Error;D.width=e.clientWidth,D.height=e.clientHeight,t.width=D.width,t.height=D.height,n()}),0)}function z(e){var t,n=Object(v.a)(J.elements);try{for(n.s();!(t=n.n()).done;){var r=t.value.pos;if(Math.pow(r.x-e.x,2)+Math.pow(r.y-e.y,2)<Math.pow(24,2))return!0}}catch(o){n.e(o)}finally{n.f()}return!1}function F(e){for(var t=L({x:D.width/2,y:D.height/2});z(t);)t.x+=68;J.elements.push({type:e,id:M(J),pos:t}),n()}function $(e){var t=e.elId,n=e.pinIndex;W.elId=t,B.source={elId:t,pinIndex:n}}n=u((function(){var e,t=function(e){if(!e)throw new Error;var t=e.getContext("2d");if(!t)throw new Error;return t}(c.current);t.clearRect(0,0,D.width,D.height),t.save(),t.translate(D.width/2+S.x+.5,D.height/2+S.y+.5);var n,r=Object(v.a)(J.elements);try{for(r.s();!(n=r.n()).done;){var o,a=n.value,i=a.pos;a.id===(null===(o=V.target)||void 0===o?void 0:o.elId)?(t.save(),t.strokeStyle="#ddf",t.lineWidth=3,t.strokeRect(i.x-26,i.y-26,E,E),t.restore()):a.id===W.elId&&(t.save(),t.strokeStyle="#ededf3",t.lineWidth=2,t.strokeRect(i.x-26,i.y-26,E,E),t.restore())}}catch(Q){r.e(Q)}finally{r.f()}var l,u=Object(v.a)(J.connections);try{for(u.s();!(l=u.n()).done;){var p=Object(s.a)(l.value,2),f=p[0],h=p[1],j=Y(f.elId),g=Y(h.elId),y=b[j.type].pins[f.pinIndex],I=b[g.type].pins[h.pinIndex];t.save(),t.beginPath(),t.moveTo(j.pos.x-24+y.pos.x*k,j.pos.y-24+y.pos.y*k),t.lineTo(g.pos.x-24+I.pos.x*k,g.pos.y-24+I.pos.y*k),t.strokeStyle="#333",t.stroke(),t.restore()}}catch(Q){u.e(Q)}finally{u.f()}if(B.source){var w=B.source,_=w.elId,P=w.pinIndex,T=Y(_),M=b[T.type].pins[P].pos,C=M.x*k+T.pos.x-24,A=M.y*k+T.pos.y-24,X=L(R),H=X.x,Z=X.y;t.save(),t.beginPath(),t.moveTo(C,A),t.lineTo(H,Z),t.strokeStyle="#888",t.stroke(),t.restore()}var z,F,$=Object(v.a)(J.elements);try{var q=function(){var e=z.value,n=e.type,r=e.pos;if(n===d.INPUT||n===d.OUTPUT){var o=m(J.elements.filter((function(e){return e.type===n})),e,n===d.INPUT?N.isInputVector:N.isOutputVector);t.save(),t.textAlign="center",t.textBaseline="middle",t.font="24px sans-serif",n===d.INPUT?t.fillText(o,r.x,r.y-10):t.fillText(o,r.x+6,r.y),t.restore()}else{var c=U[n];if(c){var a=r.x-24,i=r.y-24;t.drawImage(c,a,i,k,k)}}var s,l=b[n].pins,u=V.target,p=0,f=Object(v.a)(l);try{for(f.s();!(s=f.n()).done;){var h=s.value,j=u&&e.id===u.elId&&u.activePin&&u.activePin.index===p,x=B.source&&B.source.elId===e.id&&B.source.pinIndex===p;t.beginPath(),t.arc(r.x+(h.pos.x-.5)*k,r.y+(h.pos.y-.5)*k,j?6:5,0,2*Math.PI),t.closePath(),j||x?(t.save(),t.fillStyle=x?"#d66":"#66d",t.fill(),t.restore()):(t.save(),t.fillStyle="#fff",t.fill(),t.strokeStyle="#448",t.lineWidth=2,t.stroke(),t.restore()),p+=1}}catch(Q){f.e(Q)}finally{f.f()}};for($.s();!(z=$.n()).done;)q()}catch(Q){$.e(Q)}finally{$.f()}t.restore(),B.source||(null===(e=V.target)||void 0===e?void 0:e.activePin)?F="pointer":V.target?F="move":G.isDrag&&(F="grabbing"),F!==x&&O(F)})),Object(r.useEffect)((function(){Z(),window.addEventListener("resize",Z),function(){var e=[d.PNP,d.NPN,d.POWER,d.GROUND],t=e.length;function r(){0===(t-=1)&&n()}for(var o=0,c=e;o<c.length;o++){var a=c[o],i=new Image;i.src="assets/".concat(a,".png"),i.addEventListener("load",r),U[a]=i}}()}),[]),l(n,[N]);var q=u((function(e){if(!e||(e.preventDefault(),0===e.button)){var t=!1;if(G.isMouseDown=!1,!W.elId||B.source||A.target||(W.elId=void 0,t=!0),A.target&&(A.target=void 0,t=!0),G.isDrag&&(G.isDrag=!1,t=!0),B.source){var r=V.target;r&&r.activePin&&B.source.elId!==r.elId&&J.connections.push([{elId:r.elId,pinIndex:r.activePin.index},{elId:B.source.elId,pinIndex:B.source.pinIndex}]),B.source=void 0,t=!0}else if(!B.source){var o=V.target;o&&o.activePin&&($({elId:o.elId,pinIndex:o.activePin.index}),t=!0),o&&!o.activePin&&W.elId!==o.elId&&(W.elId=o.elId,t=!0)}t&&n()}}));return Object(I.jsxs)("main",{className:T.a.app,children:[Object(I.jsx)("div",{ref:a,className:T.a.canvasWrapper,children:Object(I.jsx)("canvas",{ref:c,className:T.a.canvas,style:x?{cursor:x}:void 0,onClick:function(e){e.preventDefault()},onMouseDown:function(e){e.preventDefault(),0===e.button&&(G.isMouseDown&&q(),G.isMouseDown=!0)},onMouseMove:function(e){R.x=e.clientX,R.y=e.clientY;var t=!1;(function(){var e,t=L(R),n=t.x,r=t.y,o=V.target,c=Object(v.a)(J.elements);try{for(c.s();!(e=c.n()).done;){var a,i=e.value,s=b[i.type].pins,l=i.pos.x-24,u=i.pos.y-24,d=Object(v.a)(s);try{for(d.s();!(a=d.n()).done;){var p=a.value;if(Math.pow(l+p.pos.x*k-n,2)+Math.pow(u+p.pos.y*k-r,2)<Math.pow(9,2)){var f,h=s.indexOf(p),j=V.target;return(!j||j.elId!==i.id||(null===(f=j.activePin)||void 0===f?void 0:f.index)!==h)&&(V.target={elId:i.id,activePin:{index:h}},!0)}}}catch(I){d.e(I)}finally{d.f()}}}catch(I){c.e(I)}finally{c.f()}var x,O=Object(v.a)(J.elements);try{for(O.s();!(x=O.n()).done;){var m=x.value,g=m.pos.x-24,y=m.pos.y-24;if(n>g&&n<g+k&&r>y&&r<y+k)return!(o&&o.elId===m.id&&!o.activePin)&&(V.target={elId:m.id,activePin:void 0},!0)}}catch(I){O.e(I)}finally{O.f()}return!!V.target&&(V.target=void 0,!0)})()&&(t=!0);var r=Boolean(A.target),o=V.target;if(G.isMouseDown){if(!r&&!B.source&&o&&o.activePin&&($({elId:o.elId,pinIndex:o.activePin.index}),t=!0),!r&&B.source&&(t=!0),r||B.source||!o||(A.target={elId:o.elId},W.elId=o.elId,t=!0),B.source||A.target||G.isDrag||(G.isDrag=!0,t=!0),A.target){var c=Y(A.target.elId);c.pos.x+=e.movementX,c.pos.y+=e.movementY}else B.source||(S.x+=e.movementX,S.y+=e.movementY);t=!0}else G.isDrag&&(G.isDrag=!1,t=!0);B.source&&(t=!0),t&&n()},onMouseUp:q,onMouseLeave:function(){(function(){var e=!1;return G.isMouseDown&&(G.isMouseDown=!1),A.target&&(A.target=void 0,e=!0),G.isDrag&&(G.isDrag=!1,e=!0),B.source&&(B.source=void 0,e=!0),e})()&&n()},onContextMenu:function(e){(V.target||B.source||G.isDrag)&&e.preventDefault()}})}),Object(I.jsxs)("div",{className:T.a.panel,children:[Object(I.jsx)("button",{type:"button",className:T.a.button,onClick:function(e){e.preventDefault(),F(d.POWER)},children:"DD"}),Object(I.jsx)("button",{type:"button",className:T.a.button,onClick:function(e){e.preventDefault(),F(d.GROUND)},children:"GND"}),Object(I.jsx)("button",{type:"button",className:T.a.button,onClick:function(e){e.preventDefault(),F(d.NPN)},children:"npn"}),Object(I.jsx)("button",{type:"button",className:T.a.button,onClick:function(e){e.preventDefault(),F(d.PNP)},children:"pnp"}),Object(I.jsx)("button",{type:"button",className:T.a.button,onClick:function(e){e.preventDefault(),F(d.INPUT)},children:"input"}),Object(I.jsx)("button",{type:"button",className:T.a.button,onClick:function(e){e.preventDefault(),F(d.OUTPUT)},children:"output"}),Object(I.jsx)("button",{type:"button",className:T.a.button,onClick:function(e){e.preventDefault(),F(d.DOT)},children:"dot"}),Object(I.jsx)("span",{className:T.a.divider}),Object(I.jsx)("button",{type:"button",className:T.a.button,onClick:function(e){e.preventDefault(),H()},children:"Load"}),Object(I.jsx)("button",{type:"button",className:T.a.button,onClick:function(e){e.preventDefault(),localStorage.setItem("sch_game_".concat(o),JSON.stringify({pos:S,elements:J.elements,connections:J.connections,options:N})),console.info("Saved")},children:"Save"}),Object(I.jsx)("button",{type:"button",className:T.a.button,onClick:function(e){e.preventDefault(),X(),n()},children:"Clear"}),Object(I.jsx)("a",{href:"#",children:Object(I.jsx)("button",{type:"button",className:T.a.button,children:"Exit"})})]}),Object(I.jsxs)("div",{className:T.a.info,children:[Object(I.jsx)(w,{elements:J.elements,options:N,onOptionsChange:function(e){return _(Object(p.a)(Object(p.a)({},N),e))}}),Object(I.jsx)(P,{state:J}),Object(I.jsx)("span",{className:T.a.space}),Object(I.jsxs)("div",{className:T.a.debugPanel,children:[Object(I.jsxs)("div",{children:["elements: ",J.elements.length]}),Object(I.jsxs)("div",{children:["connections: ",J.connections.length]}),Object(I.jsxs)("div",{children:["el moving: ",C(A.target)]}),Object(I.jsxs)("div",{children:["el in focus: ",C(W.elId)]}),Object(I.jsxs)("div",{children:["el hover: ",C(V.target)]}),Object(I.jsxs)("div",{children:["pin hover: ",C(null===(t=V.target)||void 0===t?void 0:t.activePin)]}),Object(I.jsxs)("div",{children:["wiring: ",C(B.source)]}),Object(I.jsxs)("div",{children:["drag: ",C(G.isDrag)]}),Object(I.jsxs)("div",{children:["mouse down: ",C(G.isMouseDown)]})]})]})]})}var U=n(10),R=n.n(U);function V(e){var t,n=(null!==(t=window.location.hash)&&void 0!==t?t:"").trim().replace(/^#/,"");if(n){var r=n.match(/^g(\d+)$/);if(r){var o=r[0];if(e.includes(o))return o}}}function W(){var e=Object(r.useMemo)((function(){var e=localStorage.getItem("sch_games");return e?JSON.parse(e):[]}),[]),t=Object(r.useState)(e),n=Object(s.a)(t,2),o=n[0],c=n[1];l((function(){localStorage.setItem("sch_games",JSON.stringify(o))}),[o]);var a=Object(r.useState)(V(o)),d=Object(s.a)(a,2),p=d[0],v=d[1];return function(e,t){var n=u(t);Object(r.useEffect)((function(){return window.addEventListener(e,n,!1),function(){window.removeEventListener(e,n,!1)}}),[e,n])}("hashchange",(function(){var e=V(o);e!==p&&v(e)})),p?Object(I.jsx)(S,{gameId:p},p):Object(I.jsxs)("div",{className:R.a.wrapper,children:[Object(I.jsx)("h1",{className:R.a.title,children:"Schematic"}),Object(I.jsx)("h2",{className:R.a.gamesTitle,children:"Current schemas:"}),Object(I.jsx)("ul",{children:o.length?o.map((function(e){return Object(I.jsxs)("li",{children:[Object(I.jsx)("a",{href:"#".concat(e),children:e})," ",Object(I.jsx)("button",{type:"button",className:R.a.removeButton,onClick:function(t){t.preventDefault(),window.confirm("Are you sure?")&&(c(o.filter((function(t){return t!==e}))),localStorage.removeItem("sch_game_".concat(e)))},children:"x"})]},e)})):Object(I.jsx)("div",{children:"no saved schemas"})}),Object(I.jsx)("button",{type:"button",onClick:function(e){e.preventDefault();var t=function(e){var t=e[e.length-1];if(!t)return"g1";var n=t.match(/^g(\d+)$/);if(!n)throw new Error;return"g".concat(parseInt(n[1],10)+1)}(o);c([].concat(Object(i.a)(o),[t])),window.setTimeout((function(){window.location.assign("#".concat(t))}),0)},children:"New schema"})]})}a.a.render(Object(I.jsx)(o.a.StrictMode,{children:Object(I.jsx)(W,{})}),document.getElementById("root"))},6:function(e,t,n){e.exports={wrapper:"TruthTable_wrapper__23wrn",options:"TruthTable_options__kzZt2",option:"TruthTable_option__1Hqnt"}}},[[21,1,2]]]);
//# sourceMappingURL=main.4056d06b.chunk.js.map